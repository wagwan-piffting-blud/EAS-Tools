/*! For license information please see ort.wasm.bundle.min.mjs.LICENSE.txt */
var e,t,r,n,a,o,i,s,u,l,f,d,p,c,h,w,m,y,g,b,v,E,T,O,A,C,_,R,U,I,x,L,M,P,S=Object.defineProperty,$=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,B=Object.prototype.hasOwnProperty,N=(e=function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):e),D=(e,t)=>()=>(e&&(t=e(e=0)),t),F=(e,t)=>{for(var r in t)S(e,r,{get:t[r],enumerable:!0})},G=e=>((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of k(t))!B.call(e,r)&&undefined!==r&&S(e,r,{get:()=>t[r],enumerable:!(n=$(t,r))||n.enumerable});return e})(S({},"__esModule",{value:!0}),e),W=D(()=>{t=new Map,r=[],n=(e,n,a)=>{if(n&&"function"==typeof n.init&&"function"==typeof n.createInferenceSessionHandler){let o=t.get(e);if(void 0===o)t.set(e,{backend:n,priority:a});else{if(o.priority>a)return;if(o.priority===a&&o.backend!==n)throw new Error(`cannot register backend "${e}" using priority ${a}`)}if(a>=0){let n=r.indexOf(e);-1!==n&&r.splice(n,1);for(let n=0;n<r.length;n++)if(t.get(r[n]).priority<=a)return void r.splice(n,0,e);r.push(e)}return}throw new TypeError("not a valid backend")},a=async e=>{let r=t.get(e);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let t=!!r.initPromise;try{return t||(r.initPromise=r.backend.init(e)),await r.initPromise,r.initialized=!0,r.backend}catch(e){return t||(r.error=`${e}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},o=async e=>{let t,n=e.executionProviders||[],o=n.map(e=>"string"==typeof e?e:e.name),i=0===o.length?r:o,s=[],u=new Set;for(let e of i){let r=await a(e);"string"==typeof r?s.push({name:e,err:r}):(t||(t=r),t===r&&u.add(e))}if(!t)throw new Error(`no available backend found. ERR: ${s.map(e=>`[${e.name}] ${e.err}`).join(", ")}`);for(let{name:e,err:t}of s)o.includes(e)&&console.warn(`removing requested execution provider "${e}" from session options because it is not available: ${t}`);let l=n.filter(e=>u.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?l:Reflect.get(e,t)})]}}),j=D(()=>{W()}),V=D(()=>{i="1.23.0"}),H=D(()=>{V(),s="warning",u={wasm:{},webgl:{},webgpu:{},versions:{common:i},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error(`Unsupported logging level: ${e}`);s=e}},get logLevel(){return s}},Object.defineProperty(u,"logLevel",{enumerable:!0})}),z=D(()=>{H(),l=u}),q=D(()=>{f=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(null!=n){let a,o;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(a=e.dims[2],o=e.dims[3]):(a=e.dims[3],o=e.dims[2]);let i,s,u=void 0!==t?.format?t.format:"RGB",l=t?.norm;void 0===l||void 0===l.mean?i=[255,255,255,255]:"number"==typeof l.mean?i=[l.mean,l.mean,l.mean,l.mean]:(i=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(i[3]=l.mean[3])),void 0===l||void 0===l.bias?s=[0,0,0,0]:"number"==typeof l.bias?s=[l.bias,l.bias,l.bias,l.bias]:(s=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(s[3]=l.bias[3]));let f=o*a,d=0,p=f,c=2*f,h=-1;"RGBA"===u?(d=0,p=f,c=2*f,h=3*f):"RGB"===u?(d=0,p=f,c=2*f):"RBG"===u&&(d=0,c=f,p=2*f);for(let t=0;t<o;t++)for(let r=0;r<a;r++){let a=(e.data[d++]-s[0])*i[0],o=(e.data[p++]-s[1])*i[1],u=(e.data[c++]-s[2])*i[2],l=-1===h?255:(e.data[h++]-s[3])*i[3];n.fillStyle="rgba("+a+","+o+","+u+","+l+")",n.fillRect(r,t,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},d=(e,t)=>{let r,n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==n)throw new Error("Can not access image data");{let a,o,i;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(a=e.dims[2],o=e.dims[1],i=e.dims[3]):(a=e.dims[3],o=e.dims[2],i=e.dims[1]);let s,u,l=void 0!==t&&void 0!==t.format?t.format:"RGB",f=t?.norm;void 0===f||void 0===f.mean?s=[255,255,255,255]:"number"==typeof f.mean?s=[f.mean,f.mean,f.mean,f.mean]:(s=[f.mean[0],f.mean[1],f.mean[2],255],void 0!==f.mean[3]&&(s[3]=f.mean[3])),void 0===f||void 0===f.bias?u=[0,0,0,0]:"number"==typeof f.bias?u=[f.bias,f.bias,f.bias,f.bias]:(u=[f.bias[0],f.bias[1],f.bias[2],0],void 0!==f.bias[3]&&(u[3]=f.bias[3]));let d=o*a;if(void 0!==t&&(void 0!==t.format&&4===i&&"RGBA"!==t.format||3===i&&"RGB"!==t.format&&"BGR"!==t.format))throw new Error("Tensor format doesn't match input tensor dims");let p=4,c=0,h=1,w=2,m=3,y=0,g=d,b=2*d,v=-1;"RGBA"===l?(y=0,g=d,b=2*d,v=3*d):"RGB"===l?(y=0,g=d,b=2*d):"RBG"===l&&(y=0,b=d,g=2*d),r=n.createImageData(a,o);for(let t=0;t<o*a;c+=p,h+=p,w+=p,m+=p,t++)r.data[c]=(e.data[y++]-u[0])*s[0],r.data[h]=(e.data[g++]-u[1])*s[1],r.data[w]=(e.data[b++]-u[2])*s[2],r.data[m]=-1===v?255:(e.data[v++]-u[3])*s[3]}return r}}),Y=D(()=>{X(),p=(e,t)=>{if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let r,n,{height:a,width:o}=t,i=t.norm??{mean:255,bias:0};r="number"==typeof i.mean?[i.mean,i.mean,i.mean,i.mean]:[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],n="number"==typeof i.bias?[i.bias,i.bias,i.bias,i.bias]:[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let s=void 0!==t.format?t.format:"RGBA",u=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",l=a*o,f="RGBA"===u?new Float32Array(4*l):new Float32Array(3*l),d=4,p=0,c=1,h=2,w=3,m=0,y=l,g=2*l,b=-1;"RGB"===s&&(d=3,p=0,c=1,h=2,w=-1),"RGBA"===u?b=3*l:"RBG"===u?(m=0,g=l,y=2*l):"BGR"===u&&(g=0,y=l,m=2*l);for(let t=0;t<l;t++,p+=d,h+=d,c+=d,w+=d)f[m++]=(e[p]+n[0])/r[0],f[y++]=(e[c]+n[1])/r[1],f[g++]=(e[h]+n[2])/r[2],-1!==b&&-1!==w&&(f[b++]=(e[w]+n[3])/r[3]);return new A("float32",f,"RGBA"===u?[1,4,a,o]:[1,3,a,o])},c=async(e,t)=>{let r,n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,a=typeof ImageData<"u"&&e instanceof ImageData,o=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,i="string"==typeof e,s=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=e=>typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(n){let n=u();n.width=e.width,n.height=e.height;let a=l(n);if(null==a)throw new Error("Can not access image data");{let n=e.height,o=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(n=t.resizedHeight,o=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=n,s.width=o}else s.tensorFormat="RGBA",s.height=n,s.width=o;a.drawImage(e,0,0),r=a.getImageData(0,0,o,n).data}}else{if(!a){if(o){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");let n=u();n.width=e.width,n.height=e.height;let a=l(n);if(null!=a){let t=e.height,n=e.width;return a.drawImage(e,0,0,n,t),r=a.getImageData(0,0,n,t).data,s.height=t,s.width=n,p(r,s)}throw new Error("Can not access image data")}if(i)return new Promise((t,r)=>{let n=u(),a=l(n);if(!e||!a)return r();let o=new Image;o.crossOrigin="Anonymous",o.src=e,o.onload=()=>{n.width=o.width,n.height=o.height,a.drawImage(o,0,0,n.width,n.height);let e=a.getImageData(0,0,n.width,n.height);s.height=n.height,s.width=n.width,t(p(e.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let n,a;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(n=t.resizedHeight,a=t.resizedWidth):(n=e.height,a=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=n,s.width=a,void 0!==t){let t=u();t.width=a,t.height=n;let o=l(t);if(null==o)throw new Error("Can not access image data");o.putImageData(e,0,0),r=o.getImageData(0,0,a,n).data}else r=e.data}}if(void 0!==r)return p(r,s);throw new Error("Input data provided is not supported - aborted tensor creation")},h=(e,t)=>{let{width:r,height:n,download:a,dispose:o}=t;return new A({location:"texture",type:"float32",texture:e,dims:[1,n,r,4],download:a,dispose:o})},w=(e,t)=>{let{dataType:r,dims:n,download:a,dispose:o}=t;return new A({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:a,dispose:o})},m=(e,t)=>{let{dataType:r,dims:n,download:a,dispose:o}=t;return new A({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:a,dispose:o})},y=(e,t,r)=>new A({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),Z=D(()=>{g=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),b=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),v=!1,E=()=>{if(!v){v=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(g.set("int64",BigInt64Array),b.set(BigInt64Array,"int64")),t&&(g.set("uint64",BigUint64Array),b.set(BigUint64Array,"uint64")),n?(g.set("float16",r),b.set(r,"float16")):g.set("float16",Uint16Array)}}}),Q=D(()=>{X(),T=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if("number"!=typeof n||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},O=(e,t)=>{switch(e.location){case"cpu":return new A(e.type,e.data,t);case"cpu-pinned":return new A({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new A({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new A({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new A({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),X=D(()=>{q(),Y(),Z(),Q(),A=class{constructor(e,t,r){let n,a;if(E(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,n=e.type,a=e.dims,e.location){case"cpu-pinned":{let t=g.get(n);if(!t)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof t))throw new TypeError(`buffer should be of type ${t.name}`);this.cpuData=e.data;break}case"texture":if("float32"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint64"!==n&&"int8"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,i;if("string"==typeof e)if(n=e,i=r,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");o=t}else{let r=g.get(e);if(void 0===r)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if("float16"===e&&r===Uint16Array||"uint4"===e||"int4"===e)throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${r.name} as data.`);o="uint64"===e||"int64"===e?r.from(t,BigInt):r.from(t)}else if(t instanceof r)o=t;else if(t instanceof Uint8ClampedArray){if("uint8"!==e)throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");o=Uint8Array.from(t)}else{if(!("float16"===e&&t instanceof Uint16Array&&r!==Uint16Array))throw new TypeError(`A ${n} tensor's data must be type of ${r}`);o=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length)}}else if(i=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)n="string",o=e;else{if("boolean"!==t)throw new TypeError(`Invalid element type of data array: ${t}.`);n="bool",o=Uint8Array.from(e)}}else if(e instanceof Uint8ClampedArray)n="uint8",o=Uint8Array.from(e);else{let t=b.get(e.constructor);if(void 0===t)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=t,o=e}if(void 0===i)i=[o.length];else if(!Array.isArray(i))throw new TypeError("A tensor's dims must be a number array");a=i,this.cpuData=o,this.dataLocation="cpu"}let o=T(a);if(this.cpuData&&o!==this.cpuData.length&&("uint4"!==n&&"int4"!==n||Math.ceil(o/2)!==this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=a,this.size=o}static async fromImage(e,t){return c(e,t)}static fromTexture(e,t){return h(e,t)}static fromGpuBuffer(e,t){return w(e,t)}static fromMLTensor(e,t){return m(e,t)}static fromPinnedBuffer(e,t,r){return y(e,t,r)}toDataURL(e){return f(this,e)}toImageData(e){return d(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return O(this,e)}}}),J=D(()=>{X(),C=A}),K=D(()=>{H(),_=(e,t)=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.timeStamp(`${e}::ORT::${t}`)},R=(e,t)=>{let r=(new Error).stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let a=0;a<r.length;a++){if(n&&!r[a].includes("TRACE_FUNC")){let n=`FUNC_${e}::${r[a].trim().split(" ")[1]}`;return t&&(n+=`::${t}`),void _("CPU",n)}r[a].includes("TRACE_FUNC")&&(n=!0)}},U=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||R("BEGIN",e)},I=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||R("END",e)},x=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.time(`ORT::${e}`)},L=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.timeEnd(`ORT::${e}`)}}),ee=D(()=>{W(),J(),K(),M=class e{constructor(e){this.handler=e}async run(e,t,r){U(),x("InferenceSession.run");let n={},a={};if("object"!=typeof e||null===e||e instanceof C||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof C)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(let e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError(`'fetches' contains invalid output name: ${e}.`);n[e]=null}if("object"==typeof r&&null!==r)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let e=!1,i=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==i.indexOf(r)){let a=t[r];(null===a||a instanceof C)&&(e=!0,o=!1,n[r]=a)}if(e){if("object"==typeof r&&null!==r)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else a=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(typeof e[t]>"u")throw new Error(`input '${t}' is missing in 'feeds'.`);if(o)for(let e of this.outputNames)n[e]=null;let i=await this.handler.run(e,n,a),s={};for(let e in i)if(Object.hasOwnProperty.call(i,e)){let t=i[e];s[e]=t instanceof C?t:new C(t.type,t.data,t.dims)}return L("InferenceSession.run"),I(),s}async release(){return this.handler.dispose()}static async create(t,r,n,a){U(),x("InferenceSession.create");let i,s={};if("string"==typeof t){if(i=t,"object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(i=t,"object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{if(!(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let e=t,o=0,u=t.byteLength;if("object"==typeof r&&null!==r)s=r;else if("number"==typeof r){if(o=r,!Number.isSafeInteger(o))throw new RangeError("'byteOffset' must be an integer.");if(o<0||o>=e.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${e.byteLength}).`);if(u=t.byteLength-o,"number"==typeof n){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||o+u>e.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${e.byteLength-o}].`);if("object"==typeof a&&null!==a)s=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(e,o,u)}}let[u,l]=await o(s),f=await u.createInferenceSessionHandler(i,l);return L("InferenceSession.create"),I(),new e(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),te=D(()=>{ee(),P=M}),re=D(()=>{}),ne=D(()=>{}),ae=D(()=>{}),oe=D(()=>{}),ie={};F(ie,{InferenceSession:()=>P,TRACE:()=>_,TRACE_EVENT_BEGIN:()=>x,TRACE_EVENT_END:()=>L,TRACE_FUNC_BEGIN:()=>U,TRACE_FUNC_END:()=>I,Tensor:()=>C,env:()=>l,registerBackend:()=>n});var se=D(()=>{j(),z(),te(),J(),re(),ne(),K(),ae(),oe()}),ue=D(()=>{}),le={};F(le,{default:()=>pe});var fe,de,pe,ce=D(()=>{Yt(),Wt(),Gt(),fe="ort-wasm-proxy-worker",(de=globalThis.self?.name===fe)&&(self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":De(r.wasm).then(()=>{st(r).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:n}=r;ut(n,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=r,n=pt(e);postMessage({type:t,out:n});break}case"create":{let{model:e,options:n}=r;ct(e,n).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":ht(r),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:n,inputs:a,outputIndices:o,options:i}=r;mt(e,n,a,o,new Array(o.length).fill(null),i).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},gt([...a,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":yt(r),postMessage({type:t})}}catch(e){postMessage({type:t,err:e})}}),pe=de?null:e=>new Worker(e??Ee,{type:"module",name:fe})}),he={};F(he,{default:()=>me});var we,me,ye,ge,be,ve,Ee,Te,Oe,Ae,Ce,_e,Re,Ue,Ie,xe,Le,Me,Pe,Se,$e,ke,Be,Ne,De,Fe,Ge,We,je,Ve,He,ze,qe,Ye,Ze,Qe,Xe,Je,Ke,et,tt,rt,nt,at,ot,it,st,ut,lt,ft,dt,pt,ct,ht,wt,mt,yt,gt,bt,vt,Et,Tt,Ot,At,Ct,_t,Rt,Ut,It,xt,Lt,Mt,Pt,St,$t,kt,Bt,Nt,Dt,Ft=D(()=>{we=async function(e={}){var t,r,n=e,a=new Promise((e,n)=>{t=e,r=n}),o="object"==typeof window,i=typeof WorkerGlobalScope<"u",s=i&&self.name?.startsWith("em-pthread");n.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(n.Sa||(n.Sa=new Map)).set(e,t)},n.unmountExternalData=()=>{delete n.Sa};var u,l,f=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,kb:!0}).buffer.constructor,d=(e,t)=>{throw t},p=import.meta.url,c="";if(o||i){try{c=new URL(".",p).href}catch{}i&&(l=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),u=async e=>{if(M(e))return new Promise((t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r(n.status)},n.onerror=r,n.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var h,w,m,y,g,b,v,E,T,O,A,C,_,R=console.log.bind(console),U=console.error.bind(console),I=R,x=U,L=!1,M=e=>e.startsWith("file://");function P(){return w.buffer!=g.buffer&&G(),g}function S(){return w.buffer!=g.buffer&&G(),b}function $(){return w.buffer!=g.buffer&&G(),v}function k(){return w.buffer!=g.buffer&&G(),E}function B(){return w.buffer!=g.buffer&&G(),T}function N(){return w.buffer!=g.buffer&&G(),O}function D(){return w.buffer!=g.buffer&&G(),C}if(s){let e=function(t){try{var r=t.data,a=r.Ra;if("load"===a){let t=[];self.onmessage=e=>t.push(e),self.startWorker=()=>{postMessage({Ra:"loaded"});for(let r of t)e(r);self.onmessage=e};for(let e of r.Za)n[e]&&!n[e].proxy||(n[e]=(...t)=>{postMessage({Ra:"callHandler",Ya:e,args:t})},"print"==e&&(I=n[e]),"printErr"==e&&(x=n[e]));w=r.fb,G(),_(r.gb)}else if("run"===a){ce(r.Qa),Dt(r.Qa,0,0,1,0,0),le(),De(r.Qa),F||=!0;try{we(r.bb,r.Va)}catch(e){if("unwind"!=e)throw e}}else"setimmediate"!==r.target&&("checkMailbox"===a?F&&Fe():a&&(x(`worker: received unknown command ${a}`),x(r)))}catch(e){throw Ft(),e}};var F=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=e}function G(){var e=w.buffer;n.HEAP8=g=new Int8Array(e),v=new Int16Array(e),n.HEAPU8=b=new Uint8Array(e),new Uint16Array(e),n.HEAP32=E=new Int32Array(e),n.HEAPU32=T=new Uint32Array(e),O=new Float32Array(e),C=new Float64Array(e),A=new BigInt64Array(e),new BigUint64Array(e)}function W(){s?startWorker(n):Bt.$()}var j,V=0,H=null;function z(){if(0==--V&&H){var e=H;H=null,e()}}function q(e){throw x(e="Aborted("+e+")"),L=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function Y(){return{a:{j:kt,b:ye,E:be,f:Oe,U:Ae,A:Ce,C:_e,V:Re,S:Ue,L:Ie,R:xe,n:Le,B:Me,y:Pe,T:Se,z:$e,_:ke,O:Be,w:Ge,F:je,t:Ve,i:He,N:De,X:ze,I:qe,J:Xe,K:Je,G:Ke,H:et,u:nt,q:ot,Z:ut,o:ft,k:dt,Y:it,d:pt,W:ct,x:ht,c:rt,e:wt,h:mt,v:yt,s:Et,r:Tt,P:_t,Q:Ut,D:ne,g:It,m:xt,M:Lt,l:Pt,a:w,p:te}}}class Z{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var Q=e=>{e.terminate(),e.onmessage=()=>{}},X=[],J=e=>{0==ae.length&&(de(),fe(ae[0]));var t=ae.pop();if(!t)return 6;oe.push(t),se[e.Qa]=t,t.Qa=e.Qa;var r={Ra:"run",bb:e.ab,Va:e.Va,Qa:e.Qa};return t.postMessage(r,e.Xa),0},K=0,ee=(e,t,...r)=>{for(var n=2*r.length,a=Zt(),o=Yt(8*n),i=o>>>3,s=0;s<r.length;s++){var u=r[s];"bigint"==typeof u?(A[i+2*s]=1n,A[i+2*s+1]=u):(A[i+2*s]=0n,D()[i+2*s+1>>>0]=u)}return e=Gt(e,0,n,o,t),qt(a),e};function te(e){if(s)return ee(0,1,e);if(y=e,!(0<K)){for(var t of oe)Q(t);for(t of ae)Q(t);ae=[],oe=[],se={},L=!0}d(0,new Z(e))}function re(e){if(s)return ee(1,0,e);ne(e)}var ne=e=>{if(y=e,s)throw re(e),"unwind";te(e)},ae=[],oe=[],ie=[],se={},ue=e=>{var t=e.Qa;delete se[t],ae.push(e),oe.splice(oe.indexOf(e),1),e.Qa=0,Wt(t)};function le(){ie.forEach(e=>e())}var fe=e=>new Promise(t=>{e.onmessage=r=>{var a=(r=r.data).Ra;if(r.Ta&&r.Ta!=Nt()){var o=se[r.Ta];o?o.postMessage(r,r.Xa):x(`Internal error! Worker sent a message "${a}" to target pthread ${r.Ta}, but that thread no longer exists!`)}else"checkMailbox"===a?Fe():"spawnThread"===a?J(r):"cleanupThread"===a?ue(se[r.cb]):"loaded"===a?(e.loaded=!0,t(e)):"setimmediate"===r.target?e.postMessage(r):"callHandler"===a?n[r.Ya](...r.args):a&&x(`worker sent an unknown command ${a}`)},e.onerror=e=>{throw x(`worker sent an error! ${e.filename}:${e.lineno}: ${e.message}`),e};var r,a=[];for(r of[])n.propertyIsEnumerable(r)&&a.push(r);e.postMessage({Ra:"load",Za:a,fb:w,gb:m})});function de(){var e=new Worker((()=>{let e=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new e("ort.wasm.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ae.push(e)}var pe,ce=e=>{G();var t=B()[e+52>>>2>>>0];e=B()[e+56>>>2>>>0],zt(t,t-e),qt(t)},he=[],we=(e,t)=>{K=0;var r=he[e];r||(he[e]=r=pe.get(e)),e=r(t),0<K?y=e:jt(e)};class me{constructor(e){this.Ua=e-24}}function ye(e,t,r){var n=new me(e>>>=0);throw t>>>=0,r>>>=0,B()[n.Ua+16>>>2>>>0]=0,B()[n.Ua+4>>>2>>>0]=t,B()[n.Ua+8>>>2>>>0]=r,e}function ge(e,t,r,n){return s?ee(2,1,e,t,r,n):be(e,t,r,n)}function be(e,t,r,n){if(e>>>=0,r>>>=0,n>>>=0,void 0===f)return 6;var a=[];return s&&0===a.length?ge(e,t>>>=0,r,n):(e={ab:r,Qa:e,Va:n,Xa:a},s?(e.Ra="spawnThread",postMessage(e,a),0):J(e))}var ve=typeof TextDecoder<"u"?new TextDecoder:void 0,Ee=(e,t=0,r=NaN)=>{var n=(t>>>=0)+r;for(r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&ve)return ve.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(n="";t<r;){var a=e[t++];if(128&a){var o=63&e[t++];if(192==(224&a))n+=String.fromCharCode((31&a)<<6|o);else{var i=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|o<<6|i:(7&a)<<18|o<<12|i<<6|63&e[t++])?n+=String.fromCharCode(a):(a-=65536,n+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else n+=String.fromCharCode(a)}return n},Te=(e,t)=>(e>>>=0)?Ee(S(),e,t):"";function Oe(e,t,r){return s?ee(3,1,e,t,r):0}function Ae(e,t){if(s)return ee(4,1,e,t)}function Ce(e,t){if(s)return ee(5,1,e,t)}function _e(e,t,r){if(s)return ee(6,1,e,t,r)}function Re(e,t,r){return s?ee(7,1,e,t,r):0}function Ue(e,t){if(s)return ee(8,1,e,t)}function Ie(e,t,r){if(s)return ee(9,1,e,t,r)}function xe(e,t,r,n){if(s)return ee(10,1,e,t,r,n)}function Le(e,t,r,n){if(s)return ee(11,1,e,t,r,n)}function Me(e,t,r,n){if(s)return ee(12,1,e,t,r,n)}function Pe(e){if(s)return ee(13,1,e)}function Se(e,t){if(s)return ee(14,1,e,t)}function $e(e,t,r){if(s)return ee(15,1,e,t,r)}var ke=()=>q("");function Be(e){Dt(e>>>0,!i,1,!o,131072,!1),le()}var Ne=e=>{if(!L)try{if(e(),!(0<K))try{s?jt(y):ne(y)}catch(e){e instanceof Z||"unwind"==e||d(0,e)}}catch(e){e instanceof Z||"unwind"==e||d(0,e)}};function De(e){e>>>=0,"function"==typeof Atomics.eb&&(Atomics.eb(k(),e>>>2,e).value.then(Fe),e+=128,Atomics.store(k(),e>>>2,1))}var Fe=()=>{var e=Nt();e&&(De(e),Ne(Ht))};function Ge(e,t){(e>>>=0)==t>>>0?setTimeout(Fe):s?postMessage({Ta:e,Ra:"checkMailbox"}):(e=se[e])&&e.postMessage({Ra:"checkMailbox"})}var We=[];function je(e,t,r,n,a){for(t>>>=0,n/=2,We.length=n,r=a>>>0>>>3,a=0;a<n;a++)We[a]=A[r+2*a]?A[r+2*a+1]:D()[r+2*a+1>>>0];return(t?$t[t]:St[e])(...We)}var Ve=()=>{K=0};function He(e){e>>>=0,s?postMessage({Ra:"cleanupThread",cb:e}):ue(se[e])}function ze(e){}function qe(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),k()[t>>>2>>>0]=e.getUTCSeconds(),k()[t+4>>>2>>>0]=e.getUTCMinutes(),k()[t+8>>>2>>>0]=e.getUTCHours(),k()[t+12>>>2>>>0]=e.getUTCDate(),k()[t+16>>>2>>>0]=e.getUTCMonth(),k()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,k()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,k()[t+28>>>2>>>0]=e}var Ye=e=>e%4==0&&(e%100!=0||e%400==0),Ze=[0,31,60,91,121,152,182,213,244,274,305,335],Qe=[0,31,59,90,120,151,181,212,243,273,304,334];function Xe(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),k()[t>>>2>>>0]=e.getSeconds(),k()[t+4>>>2>>>0]=e.getMinutes(),k()[t+8>>>2>>>0]=e.getHours(),k()[t+12>>>2>>>0]=e.getDate(),k()[t+16>>>2>>>0]=e.getMonth(),k()[t+20>>>2>>>0]=e.getFullYear()-1900,k()[t+24>>>2>>>0]=e.getDay();var r=(Ye(e.getFullYear())?Ze:Qe)[e.getMonth()]+e.getDate()-1|0;k()[t+28>>>2>>>0]=r,k()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var n=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r)),k()[t+32>>>2>>>0]=e}function Je(e){e>>>=0;var t=new Date(k()[e+20>>>2>>>0]+1900,k()[e+16>>>2>>>0],k()[e+12>>>2>>>0],k()[e+8>>>2>>>0],k()[e+4>>>2>>>0],k()[e>>>2>>>0],0),r=k()[e+32>>>2>>>0],n=t.getTimezoneOffset(),a=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=new Date(t.getFullYear(),0,1).getTimezoneOffset(),i=Math.min(o,a);return 0>r?k()[e+32>>>2>>>0]=+(a!=o&&i==n):0<r!=(i==n)&&(a=Math.max(o,a),t.setTime(t.getTime()+6e4*((0<r?i:a)-n))),k()[e+24>>>2>>>0]=t.getDay(),r=(Ye(t.getFullYear())?Ze:Qe)[t.getMonth()]+t.getDate()-1|0,k()[e+28>>>2>>>0]=r,k()[e>>>2>>>0]=t.getSeconds(),k()[e+4>>>2>>>0]=t.getMinutes(),k()[e+8>>>2>>>0]=t.getHours(),k()[e+12>>>2>>>0]=t.getDate(),k()[e+16>>>2>>>0]=t.getMonth(),k()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Ke(e,t,r,n,a,o,i){return s?ee(16,1,e,t,r,n,a,o,i):-52}function et(e,t,r,n,a,o){if(s)return ee(17,1,e,t,r,n,a,o)}var tt={},rt=()=>performance.timeOrigin+performance.now();function nt(e,t){if(s)return ee(18,1,e,t);if(tt[e]&&(clearTimeout(tt[e].id),delete tt[e]),!t)return 0;var r=setTimeout(()=>{delete tt[e],Ne(()=>Vt(e,performance.timeOrigin+performance.now()))},t);return tt[e]={id:r,lb:t},0}var at=(e,t,r)=>{var n=S();if(t>>>=0,0<r){var a=t;r=t+r-1;for(var o=0;o<e.length;++o){var i=e.charCodeAt(o);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),127>=i){if(t>=r)break;n[t++>>>0]=i}else{if(2047>=i){if(t+1>=r)break;n[t++>>>0]=192|i>>6}else{if(65535>=i){if(t+2>=r)break;n[t++>>>0]=224|i>>12}else{if(t+3>=r)break;n[t++>>>0]=240|i>>18,n[t++>>>0]=128|i>>12&63}n[t++>>>0]=128|i>>6&63}n[t++>>>0]=128|63&i}}n[t>>>0]=0,e=t-a}else e=0;return e};function ot(e,t,r,n){e>>>=0,t>>>=0,r>>>=0,n>>>=0;var a=(new Date).getFullYear(),o=new Date(a,0,1).getTimezoneOffset();a=new Date(a,6,1).getTimezoneOffset();var i=Math.max(o,a);B()[e>>>2>>>0]=60*i,k()[t>>>2>>>0]=+(o!=a),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(o),t=t(a),a<o?(at(e,r,17),at(t,n,17)):(at(e,n,17),at(t,r,17))}var it=()=>Date.now(),st=1;function ut(e,t,r){if(!(0<=e&&3>=e))return 28;if(0===e)e=Date.now();else{if(!st)return 52;e=performance.timeOrigin+performance.now()}return A[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var lt=[];function ft(e,t,r){e>>>=0,t>>>=0,r>>>=0,lt.length=0;for(var n;n=S()[t++>>>0];){var a=105!=n;r+=(a&=112!=n)&&r%8?4:0,lt.push(112==n?B()[r>>>2>>>0]:106==n?A[r>>>3]:105==n?k()[r>>>2>>>0]:D()[r>>>3>>>0]),r+=a?8:4}return $t[e](...lt)}var dt=()=>{};function pt(e,t){return x(Te(e>>>0,t>>>0))}var ct=()=>{throw K+=1,"unwind"};function ht(){return 4294901760}var wt=()=>navigator.hardwareConcurrency;function mt(){return q("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function yt(e){e>>>=0;var t=S().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);e:{n=(Math.min(4294901760,65536*Math.ceil(Math.max(e,n)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(n),G();var a=1;break e}catch{}a=void 0}if(a)return!0}return!1}var gt=()=>(q("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),bt={},vt=e=>{e.forEach(e=>{var t=gt();t&&(bt[t]=e)})};function Et(){var e=Error().stack.toString().split("\n");return"Error"==e[0]&&e.shift(),vt(e),bt.Wa=gt(),bt.$a=e,bt.Wa}function Tt(e,t,r){if(e>>>=0,t>>>=0,bt.Wa==e)var n=bt.$a;else"Error"==(n=Error().stack.toString().split("\n"))[0]&&n.shift(),vt(n);for(var a=3;n[a]&&gt()!=e;)++a;for(e=0;e<r&&n[e+a];++e)k()[t+4*e>>>2>>>0]=gt();return e}var Ot,At={},Ct=()=>{if(!Ot){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in At)void 0===At[e]?delete t[e]:t[e]=At[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);Ot=r}return Ot};function _t(e,t){if(s)return ee(19,1,e,t);e>>>=0,t>>>=0;var r,n=0,a=0;for(r of Ct()){var o=t+n;B()[e+a>>>2>>>0]=o,n+=at(r,o,1/0)+1,a+=4}return 0}var Rt=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}return t};function Ut(e,t){if(s)return ee(20,1,e,t);e>>>=0,t>>>=0;var r=Ct();for(var n of(B()[e>>>2>>>0]=r.length,e=0,r))e+=Rt(n)+1;return B()[t>>>2>>>0]=e,0}function It(e){return s?ee(21,1,e):52}function xt(e,t,r,n){return s?ee(22,1,e,t,r,n):52}function Lt(e,t,r,n){return s?ee(23,1,e,t,r,n):70}var Mt=[null,[],[]];function Pt(e,t,r,n){if(s)return ee(24,1,e,t,r,n);t>>>=0,r>>>=0,n>>>=0;for(var a=0,o=0;o<r;o++){var i=B()[t>>>2>>>0],u=B()[t+4>>>2>>>0];t+=8;for(var l=0;l<u;l++){var f=e,d=S()[i+l>>>0],p=Mt[f];0===d||10===d?((1===f?I:x)(Ee(p)),p.length=0):p.push(d)}a+=u}return B()[n>>>2>>>0]=a,0}s||function(){for(var e=n.numThreads-1;e--;)de();X.push(()=>{var e;V++,e=()=>z(),s?e():Promise.all(ae.map(fe)).then(e)})}(),s||(w=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),G()),n.wasmBinary&&(h=n.wasmBinary),n.stackSave=()=>Zt(),n.stackRestore=e=>qt(e),n.stackAlloc=e=>Yt(e),n.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":P()[e>>>0]=t;break;case"i16":$()[e>>>1>>>0]=t;break;case"i32":k()[e>>>2>>>0]=t;break;case"i64":A[e>>>3]=BigInt(t);break;case"float":N()[e>>>2>>>0]=t;break;case"double":D()[e>>>3>>>0]=t;break;case"*":B()[e>>>2>>>0]=t;break;default:q(`invalid type for setValue: ${r}`)}},n.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return P()[e>>>0];case"i16":return $()[e>>>1>>>0];case"i32":return k()[e>>>2>>>0];case"i64":return A[e>>>3];case"float":return N()[e>>>2>>>0];case"double":return D()[e>>>3>>>0];case"*":return B()[e>>>2>>>0];default:q(`invalid type for getValue: ${t}`)}},n.UTF8ToString=Te,n.stringToUTF8=at,n.lengthBytesUTF8=Rt;var St=[te,re,ge,Oe,Ae,Ce,_e,Re,Ue,Ie,xe,Le,Me,Pe,Se,$e,Ke,et,nt,_t,Ut,It,xt,Lt,Pt],$t={851916:(e,t,r,a,o)=>{if(void 0===n||!n.Sa)return 1;if((e=Te(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=n.Sa.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),a=Number(a>>>0),t+r>e.byteLength)return 3;try{let i=e.subarray(t,t+r);switch(o){case 0:S().set(i,a>>>0);break;case 1:n.hb?n.hb(a,i):n.jb(a,i);break;default:return 4}return 0}catch{return 4}},852740:()=>typeof wasmOffsetConverter<"u"};function kt(){return typeof wasmOffsetConverter<"u"}var Bt=await async function(){function e(e,t){return r=Bt=e.exports,n=e=>()=>e()>>>0,a=e=>t=>e(t)>>>0,(r=Object.assign({},r)).Aa=n(r.Aa),r.Ca=a(r.Ca),r.Oa=a(r.Oa),r.Pa=n(r.Pa),r.__cxa_get_exception_ptr=a(r.__cxa_get_exception_ptr),Bt=r,ie.push(Bt.Da),pe=Bt.Ea,m=t,z(),Bt;var r,n,a}V++;var t=Y();if(n.instantiateWasm)return new Promise(r=>{n.instantiateWasm(t,(t,n)=>{r(e(t,n))})});if(s)return new Promise(t=>{_=r=>{var n=new WebAssembly.Instance(r,Y());t(e(n,r))}});j??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.wasm",c):c+"ort-wasm-simd-threaded.wasm":new URL("ort-wasm-simd-threaded.wasm",import.meta.url).href;try{var a=await async function(e){var t=j;if(!h&&"function"==typeof WebAssembly.instantiateStreaming&&!M(t))try{var r=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(r,e)}catch(e){x(`wasm streaming compile failed: ${e}`),x("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await async function(e){if(!h)try{var t=await u(e);return new Uint8Array(t)}catch{}if(e==j&&h)e=new Uint8Array(h);else{if(!l)throw"both async and sync fetching of the wasm failed";e=l(e)}return e}(e);return await WebAssembly.instantiate(r,t)}catch(e){x(`failed to asynchronously prepare wasm: ${e}`),q(e)}}(t,e)}(t);return e(a.instance,a.module)}catch(e){return r(e),Promise.reject(e)}}();n._OrtInit=(e,t)=>(n._OrtInit=Bt.aa)(e,t),n._OrtGetLastError=(e,t)=>(n._OrtGetLastError=Bt.ba)(e,t),n._OrtCreateSessionOptions=(e,t,r,a,o,i,s,u,l,f)=>(n._OrtCreateSessionOptions=Bt.ca)(e,t,r,a,o,i,s,u,l,f),n._OrtAppendExecutionProvider=(e,t,r,a,o)=>(n._OrtAppendExecutionProvider=Bt.da)(e,t,r,a,o),n._OrtAddFreeDimensionOverride=(e,t,r)=>(n._OrtAddFreeDimensionOverride=Bt.ea)(e,t,r),n._OrtAddSessionConfigEntry=(e,t,r)=>(n._OrtAddSessionConfigEntry=Bt.fa)(e,t,r),n._OrtReleaseSessionOptions=e=>(n._OrtReleaseSessionOptions=Bt.ga)(e),n._OrtCreateSession=(e,t,r)=>(n._OrtCreateSession=Bt.ha)(e,t,r),n._OrtReleaseSession=e=>(n._OrtReleaseSession=Bt.ia)(e),n._OrtGetInputOutputCount=(e,t,r)=>(n._OrtGetInputOutputCount=Bt.ja)(e,t,r),n._OrtGetInputOutputMetadata=(e,t,r,a)=>(n._OrtGetInputOutputMetadata=Bt.ka)(e,t,r,a),n._OrtFree=e=>(n._OrtFree=Bt.la)(e),n._OrtCreateTensor=(e,t,r,a,o,i)=>(n._OrtCreateTensor=Bt.ma)(e,t,r,a,o,i),n._OrtGetTensorData=(e,t,r,a,o)=>(n._OrtGetTensorData=Bt.na)(e,t,r,a,o),n._OrtReleaseTensor=e=>(n._OrtReleaseTensor=Bt.oa)(e),n._OrtCreateRunOptions=(e,t,r,a)=>(n._OrtCreateRunOptions=Bt.pa)(e,t,r,a),n._OrtAddRunConfigEntry=(e,t,r)=>(n._OrtAddRunConfigEntry=Bt.qa)(e,t,r),n._OrtReleaseRunOptions=e=>(n._OrtReleaseRunOptions=Bt.ra)(e),n._OrtCreateBinding=e=>(n._OrtCreateBinding=Bt.sa)(e),n._OrtBindInput=(e,t,r)=>(n._OrtBindInput=Bt.ta)(e,t,r),n._OrtBindOutput=(e,t,r,a)=>(n._OrtBindOutput=Bt.ua)(e,t,r,a),n._OrtClearBoundOutputs=e=>(n._OrtClearBoundOutputs=Bt.va)(e),n._OrtReleaseBinding=e=>(n._OrtReleaseBinding=Bt.wa)(e),n._OrtRunWithBinding=(e,t,r,a,o)=>(n._OrtRunWithBinding=Bt.xa)(e,t,r,a,o),n._OrtRun=(e,t,r,a,o,i,s,u)=>(n._OrtRun=Bt.ya)(e,t,r,a,o,i,s,u),n._OrtEndProfiling=e=>(n._OrtEndProfiling=Bt.za)(e);var Nt=()=>(Nt=Bt.Aa)();n._free=e=>(n._free=Bt.Ba)(e),n._malloc=e=>(n._malloc=Bt.Ca)(e);var Dt=(e,t,r,n,a,o)=>(Dt=Bt.Fa)(e,t,r,n,a,o),Ft=()=>(Ft=Bt.Ga)(),Gt=(e,t,r,n,a)=>(Gt=Bt.Ha)(e,t,r,n,a),Wt=e=>(Wt=Bt.Ia)(e),jt=e=>(jt=Bt.Ja)(e),Vt=(e,t)=>(Vt=Bt.Ka)(e,t),Ht=()=>(Ht=Bt.La)(),zt=(e,t)=>(zt=Bt.Ma)(e,t),qt=e=>(qt=Bt.Na)(e),Yt=e=>(Yt=Bt.Oa)(e),Zt=()=>(Zt=Bt.Pa)();return function e(){if(0<V)H=e;else if(s)t(n),W();else{for(;0<X.length;)X.shift()(n);0<V?H=e:(n.calledRun=!0,L||(W(),t(n)))}}(),n.PTR_SIZE=4,a},me=we,ye=globalThis.self?.name?.startsWith("em-pthread"),ye&&we()}),Gt=D(()=>{ue(),ge=typeof location>"u"?void 0:location.origin,be=import.meta.url>"file:"&&import.meta.url<"file;",ve=()=>{if(be){let e=URL;return new URL(new e("ort.wasm.bundle.min.mjs",import.meta.url).href,ge).href}return import.meta.url},Ee=ve(),Te=()=>{if(Ee&&!Ee.startsWith("blob:"))return Ee.substring(0,Ee.lastIndexOf("/")+1)},Oe=(e,t)=>{try{let r=t??Ee;return(r?new URL(e,r):new URL(e)).origin===ge}catch{return!1}},Ae=(e,t)=>{let r=t??Ee;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},Ce=(e,t)=>`${t??"./"}${e}`,_e=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},Re=async e=>(await import(e)).default,Ue=(ce(),G(le)).default,Ie=async()=>{if(!Ee)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Oe(Ee))return[void 0,Ue()];let e=await _e(Ee);return[e,Ue(e)]},xe=(Ft(),G(he)).default,Le=async(e,t,r,n)=>{let a=xe&&!(e||t);if(a)if(Ee)a=Oe(Ee);else{if(!n||r)throw new Error("cannot determine the script source URL.");a=!0}if(a)return[void 0,xe];{let n="ort-wasm-simd-threaded.mjs",a=e??Ae(n,t),o=r&&a&&!Oe(a,t),i=o?await _e(a):a??Ce(n,t);return[o?i:void 0,await Re(i)]}}}),Wt=D(()=>{Gt(),Pe=!1,Se=!1,$e=!1,ke=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Be=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Ne=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},De=async e=>{if(Pe)return Promise.resolve();if(Se)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if($e)throw new Error("previous call to 'initializeWebAssembly()' failed.");Se=!0;let t=e.initTimeout,r=e.numThreads;if(!1!==e.simd)if("relaxed"===e.simd){if(!Ne())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Be())throw new Error("WebAssembly SIMD is not supported in the current environment.");let n=ke();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let a=e.wasmPaths,o="string"==typeof a?a:void 0,i=a?.mjs,s=i?.href??i,u=a?.wasm,l=u?.href??u,f=e.wasmBinary,[d,p]=await Le(s,o,r>1,!!f||!!l),c=!1,h=[];if(t>0&&h.push(new Promise(e=>{setTimeout(()=>{c=!0,e()},t)})),h.push(new Promise((e,t)=>{let n={numThreads:r};if(f)n.wasmBinary=f;else if(l||o)n.locateFile=e=>l??o+e;else if(s&&0!==s.indexOf("blob:"))n.locateFile=e=>new URL(e,s).href;else if(d){let e=Te();e&&(n.locateFile=t=>e+t)}p(n).then(t=>{Se=!1,Pe=!0,Me=t,e(),d&&URL.revokeObjectURL(d)},e=>{Se=!1,$e=!0,t(e)})})),await Promise.race(h),c)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},Fe=()=>{if(Pe&&Me)return Me;throw new Error("WebAssembly is not initialized yet.")}}),jt=D(()=>{Wt(),Ge=(e,t)=>{let r=Fe(),n=r.lengthBytesUTF8(e)+1,a=r._malloc(n);return r.stringToUTF8(e,a,n),t.push(a),a},We=(e,t,r,n)=>{if("object"==typeof e&&null!==e){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([e,a])=>{let o=t?t+e:e;if("object"==typeof a)We(a,o+".",r,n);else if("string"==typeof a||"number"==typeof a)n(o,a.toString());else{if("boolean"!=typeof a)throw new Error("Can't handle extra config type: "+typeof a);n(o,a?"1":"0")}})},je=e=>{let t=Fe(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);t._OrtGetLastError(n,n+r);let a=Number(t.getValue(n,4===r?"i32":"i64")),o=t.getValue(n+r,"*"),i=o?t.UTF8ToString(o):"";throw new Error(`${e} ERROR_CODE: ${a}, ERROR_MESSAGE: ${i}`)}finally{t.stackRestore(r)}}}),Vt=D(()=>{Wt(),jt(),Ve=e=>{let t=Fe(),r=0,n=[],a=e||{};try{if(void 0===e?.logSeverityLevel)a.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${e.logSeverityLevel}`);if(void 0===e?.logVerbosityLevel)a.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);void 0===e?.terminate&&(a.terminate=!1);let o=0;return void 0!==e?.tag&&(o=Ge(e.tag,n)),r=t._OrtCreateRunOptions(a.logSeverityLevel,a.logVerbosityLevel,!!a.terminate,o),0===r&&je("Can't create run options."),void 0!==e?.extra&&We(e.extra,"",new WeakSet,(e,a)=>{let o=Ge(e,n),i=Ge(a,n);0!==t._OrtAddRunConfigEntry(r,o,i)&&je(`Can't set a run config entry: ${e} - ${a}.`)}),[r,n]}catch(e){throw 0!==r&&t._OrtReleaseRunOptions(r),n.forEach(e=>t._free(e)),e}}}),Ht=D(()=>{Wt(),jt(),He=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},ze=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},qe=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(e=>"webgpu"===("string"==typeof e?e:e.name))&&(e.enableMemPattern=!1)},Ye=(e,t,r,n)=>{let a=Ge(t,n),o=Ge(r,n);0!==Fe()._OrtAddSessionConfigEntry(e,a,o)&&je(`Can't set a session config entry: ${t} - ${r}.`)},Ze=async(e,t,r)=>{for(let n of t){let t="string"==typeof n?n:n.name,a=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof n){let t=n?.deviceType;t&&Ye(e,"deviceType",t,r)}break;case"webgpu":if(t="JS","string"!=typeof n){let t=n;if(t?.preferredLayout){if("NCHW"!==t.preferredLayout&&"NHWC"!==t.preferredLayout)throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${t.preferredLayout}`);Ye(e,"preferredLayout",t.preferredLayout,r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${t}`)}let o=Ge(t,r),i=a.length,s=0,u=0;if(i>0){s=Fe()._malloc(i*Fe().PTR_SIZE),r.push(s),u=Fe()._malloc(i*Fe().PTR_SIZE),r.push(u);for(let e=0;e<i;e++)Fe().setValue(s+e*Fe().PTR_SIZE,a[e][0],"*"),Fe().setValue(u+e*Fe().PTR_SIZE,a[e][1],"*")}0!==await Fe()._OrtAppendExecutionProvider(e,o,s,u,i)&&je(`Can't append execution provider: ${t}.`)}},Qe=async e=>{let t=Fe(),r=0,n=[],a=e||{};qe(a);try{let e=He(a.graphOptimizationLevel??"all"),o=ze(a.executionMode??"sequential"),i="string"==typeof a.logId?Ge(a.logId,n):0,s=a.logSeverityLevel??2;if(!Number.isInteger(s)||s<0||s>4)throw new Error(`log severity level is not valid: ${s}`);let u=a.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let l="string"==typeof a.optimizedModelFilePath?Ge(a.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(e,!!a.enableCpuMemArena,!!a.enableMemPattern,o,!!a.enableProfiling,0,i,s,u,l),0===r&&je("Can't create session options."),a.executionProviders&&await Ze(r,a.executionProviders,n),void 0!==a.enableGraphCapture){if("boolean"!=typeof a.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${a.enableGraphCapture}`);Ye(r,"enableGraphCapture",a.enableGraphCapture.toString(),n)}if(a.freeDimensionOverrides)for(let[e,o]of Object.entries(a.freeDimensionOverrides)){if("string"!=typeof e)throw new Error(`free dimension override name must be a string: ${e}`);if("number"!=typeof o||!Number.isInteger(o)||o<0)throw new Error(`free dimension override value must be a non-negative integer: ${o}`);let a=Ge(e,n);0!==t._OrtAddFreeDimensionOverride(r,a,o)&&je(`Can't set a free dimension override: ${e} - ${o}.`)}return void 0!==a.extra&&We(a.extra,"",new WeakSet,(e,t)=>{Ye(r,e,t,n)}),[r,n]}catch(e){throw 0!==r&&0!==t._OrtReleaseSessionOptions(r)&&je("Can't release session options."),n.forEach(e=>t._free(e)),e}}}),zt=D(()=>{Xe=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Je=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},Ke=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return r>0?Math.ceil(n*r):void 0},et=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},tt=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},rt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,nt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,at=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),qt=D(()=>{ue(),ot=async e=>{if("string"==typeof e){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let r,a=t.body.getReader();try{r=new ArrayBuffer(n)}catch(e){if(!(e instanceof RangeError))throw e;{let e=Math.ceil(n/65536);r=new WebAssembly.Memory({initial:e,maximum:e}).buffer}}let o=0;for(;;){let{done:e,value:t}=await a.read();if(e)break;let n=t.byteLength;new Uint8Array(r,o,n).set(t),o+=n}return new Uint8Array(r,0,n)}}return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),Yt=D(()=>{se(),Vt(),Ht(),zt(),Wt(),jt(),qt(),it=(e,t)=>{0!==Fe()._OrtInit(e,t)&&je("Can't initialize onnxruntime.")},st=async e=>{it(e.wasm.numThreads,tt(e.logLevel))},ut=async(e,t)=>{Fe().asyncInit?.();let r=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(r){if("object"!=typeof r.limits||"object"!=typeof r.features||"function"!=typeof r.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw new Error(`Invalid powerPreference setting: "${t}"`);let n=e.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw new Error(`Invalid forceFallbackAdapter setting: "${n}"`);if(r=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:n}),!r)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment")},lt=new Map,ft=e=>{let t=Fe(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);0!==t._OrtGetInputOutputCount(e,n,n+r)&&je("Can't get session input/output count.");let a=4===r?"i32":"i64";return[Number(t.getValue(n,a)),Number(t.getValue(n+r,a))]}finally{t.stackRestore(r)}},dt=(e,t)=>{let r=Fe(),n=r.stackSave(),a=0;try{let n=r.PTR_SIZE,o=r.stackAlloc(2*n);0!==r._OrtGetInputOutputMetadata(e,t,o,o+n)&&je("Can't get session input/output metadata.");let i=Number(r.getValue(o,"*"));a=Number(r.getValue(o+n,"*"));let s=r.HEAP32[a/4];if(0===s)return[i,0];let u=r.HEAPU32[a/4+1],l=[];for(let e=0;e<u;e++){let t=Number(r.getValue(a+8+e*n,"*"));l.push(0!==t?r.UTF8ToString(t):Number(r.getValue(a+8+(e+u)*n,"*")))}return[i,s,l]}finally{r.stackRestore(n),0!==a&&r._OrtFree(a)}},pt=e=>{let t=Fe(),r=t._malloc(e.byteLength);if(0===r)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},ct=async(e,t)=>{let r,n,a=Fe();Array.isArray(e)?[r,n]=e:e.buffer===a.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=pt(e);let o=0,i=0,s=[],u=[],l=[];try{if([i,s]=await Qe(t),t?.externalData&&a.mountExternalData){let e=[];for(let r of t.externalData){let t="string"==typeof r?r:r.path;e.push(ot("string"==typeof r?r:r.data).then(e=>{a.mountExternalData(t,e)}))}await Promise.all(e)}for(let e of t?.executionProviders??[])if("webnn"===("string"==typeof e?e:e.name)){if(a.shouldTransferToMLTensor=!1,"string"!=typeof e){let t=e,r=t?.context,n=t?.gpuDevice,o=t?.deviceType,i=t?.powerPreference;a.currentContext=r||(n?await a.webnnCreateMLContext(n):await a.webnnCreateMLContext({deviceType:o,powerPreference:i}))}else a.currentContext=await a.webnnCreateMLContext();break}o=await a._OrtCreateSession(r,n,i),a.webgpuOnCreateSession?.(o),0===o&&je("Can't create a session."),a.jsepOnCreateSession?.(),a.currentContext&&(a.webnnRegisterMLContext(o,a.currentContext),a.currentContext=void 0,a.shouldTransferToMLTensor=!0);let[e,f]=ft(o),d=!!t?.enableGraphCapture,p=[],c=[],h=[],w=[];for(let t=0;t<e;t++){let[e,r,n]=dt(o,t);0===e&&je("Can't get an input name."),u.push(e);let i=a.UTF8ToString(e);p.push(i),h.push(0===r?{name:i,isTensor:!1}:{name:i,isTensor:!0,type:Je(r),shape:n})}for(let t=0;t<f;t++){let[r,n,i]=dt(o,t+e);0===r&&je("Can't get an output name."),l.push(r);let s=a.UTF8ToString(r);c.push(s),w.push(0===n?{name:s,isTensor:!1}:{name:s,isTensor:!0,type:Je(n),shape:i})}return lt.set(o,[o,u,l,null,d,!1]),[o,p,c,h,w]}catch(e){throw u.forEach(e=>a._OrtFree(e)),l.forEach(e=>a._OrtFree(e)),0!==o&&0!==a._OrtReleaseSession(o)&&je("Can't release session."),e}finally{a._free(r),0!==i&&0!==a._OrtReleaseSessionOptions(i)&&je("Can't release session options."),s.forEach(e=>a._free(e)),a.unmountExternalData?.()}},ht=e=>{let t=Fe(),r=lt.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,a,o,i,s]=r;i&&(s&&0!==t._OrtClearBoundOutputs(i.handle)&&je("Can't clear bound outputs."),0!==t._OrtReleaseBinding(i.handle)&&je("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),t.webnnOnReleaseSession?.(e),t.webgpuOnReleaseSession?.(e),a.forEach(e=>t._OrtFree(e)),o.forEach(e=>t._OrtFree(e)),0!==t._OrtReleaseSession(n)&&je("Can't release session."),lt.delete(e)},wt=async(e,t,r,n,a,o,i=!1)=>{if(!e)return void t.push(0);let s,u,l=Fe(),f=l.PTR_SIZE,d=e[0],p=e[1],c=e[3],h=c;if("string"===d&&("gpu-buffer"===c||"ml-tensor"===c))throw new Error("String tensor is not supported on GPU.");if(i&&"gpu-buffer"!==c)throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if("gpu-buffer"===c){let t=e[2].gpuBuffer;u=Ke(Xe(d),p);{let e=l.jsepRegisterBuffer;if(!e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=e(n,o,t,u)}}else if("ml-tensor"===c){let t=e[2].mlTensor;u=Ke(Xe(d),p);let r=l.webnnRegisterMLTensor;if(!r)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');s=r(n,t,Xe(d),p)}else{let t=e[2];if(Array.isArray(t)){u=f*t.length,s=l._malloc(u),r.push(s);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw new TypeError(`tensor data at index ${e} is not a string`);l.setValue(s+e*f,Ge(t[e],r),"*")}}else{let e=l.webnnIsGraphInput,o=l.webnnIsGraphOutput;if("string"!==d&&e&&o){let i=l.UTF8ToString(a);if(e(n,i)||o(n,i)){let e=Xe(d);u=Ke(e,p),h="ml-tensor";let r=l.webnnCreateTemporaryTensor,a=l.webnnUploadTensor;if(!r||!a)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let o=await r(n,e,p);a(o,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s=o}else u=t.byteLength,s=l._malloc(u),r.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,u),s)}else u=t.byteLength,s=l._malloc(u),r.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,u),s)}}let w=l.stackSave(),m=l.stackAlloc(4*p.length);try{p.forEach((e,t)=>l.setValue(m+t*f,e,4===f?"i32":"i64"));let e=l._OrtCreateTensor(Xe(d),s,u,m,p.length,at(h));0===e&&je(`Can't create tensor for input/output. session=${n}, index=${o}.`),t.push(e)}finally{l.stackRestore(w)}},mt=async(e,t,r,n,a,o)=>{let i=Fe(),s=i.PTR_SIZE,u=lt.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let l=u[0],f=u[1],d=u[2],p=u[3],c=u[4],h=(u[5],t.length),w=n.length,m=0,y=[],g=[],b=[],v=[],E=i.stackSave(),T=i.stackAlloc(h*s),O=i.stackAlloc(h*s),A=i.stackAlloc(w*s),C=i.stackAlloc(w*s);try{[m,y]=Ve(o),x("wasm prepareInputOutputTensor");for(let n=0;n<h;n++)await wt(r[n],g,v,e,f[t[n]],t[n],c);for(let t=0;t<w;t++)await wt(a[t],b,v,e,d[n[t]],h+n[t],c);L("wasm prepareInputOutputTensor");for(let e=0;e<h;e++)i.setValue(T+e*s,g[e],"*"),i.setValue(O+e*s,f[t[e]],"*");for(let e=0;e<w;e++)i.setValue(A+e*s,b[e],"*"),i.setValue(C+e*s,d[n[e]],"*");let u;i.jsepOnRunStart?.(l),i.webnnOnRunStart?.(l),u=await i._OrtRun(l,O,T,h,C,w,A,m),0!==u&&je("failed to call OrtRun().");let E=[],_=[];x("wasm ProcessOutputTensor");for(let t=0;t<w;t++){let r=Number(i.getValue(A+t*s,"*"));if(r===b[t]){E.push(a[t]);continue}let o,u=i.stackSave(),l=i.stackAlloc(4*s),f=!1,d=0;try{0!==i._OrtGetTensorData(r,l,l+s,l+2*s,l+3*s)&&je(`Can't access output tensor data on index ${t}.`);let a=4===s?"i32":"i64",u=Number(i.getValue(l,a));d=i.getValue(l+s,"*");let c=i.getValue(l+2*s,"*"),h=Number(i.getValue(l+3*s,a)),w=[];for(let e=0;e<h;e++)w.push(Number(i.getValue(c+e*s,a)));0!==i._OrtFree(c)&&je("Can't free memory for tensor dims.");let m=w.reduce((e,t)=>e*t,1);o=Je(u);let y=p?.outputPreferredLocations[n[t]];if("string"===o){if("gpu-buffer"===y||"ml-tensor"===y)throw new Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<m;t++){let r=i.getValue(d+t*s,"*"),n=i.getValue(d+(t+1)*s,"*"),a=t===m-1?void 0:n-r;e.push(i.UTF8ToString(r,a))}E.push([o,w,e,"cpu"])}else if("gpu-buffer"===y&&m>0){let e=i.jsepGetBuffer;if(!e)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let t=e(d),n=Ke(u,m);if(void 0===n||!rt(o))throw new Error(`Unsupported data type: ${o}`);f=!0,E.push([o,w,{gpuBuffer:t,download:i.jsepCreateDownloader(t,n,o),dispose:()=>{0!==i._OrtReleaseTensor(r)&&je("Can't release tensor.")}},"gpu-buffer"])}else if("ml-tensor"===y&&m>0){let t=i.webnnEnsureTensor,n=i.webnnIsGraphInputOutputTypeSupported;if(!t||!n)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===Ke(u,m)||!nt(o))throw new Error(`Unsupported data type: ${o}`);if(!n(e,o,!1))throw new Error(`preferredLocation "ml-tensor" for ${o} output is not supported by current WebNN Context.`);let a=await t(e,d,u,w,!1);f=!0,E.push([o,w,{mlTensor:a,download:i.webnnCreateMLTensorDownloader(d,o),dispose:()=>{i.webnnReleaseTensorId(d),i._OrtReleaseTensor(r)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===y&&m>0){let e=i.webnnCreateMLTensorDownloader(d,o)(),t=E.length;f=!0,_.push((async()=>{let n=[t,await e];return i.webnnReleaseTensorId(d),i._OrtReleaseTensor(r),n})()),E.push([o,w,[],"cpu"])}else{let e=new(et(o))(m);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(i.HEAPU8.subarray(d,d+e.byteLength)),E.push([o,w,e,"cpu"])}}finally{i.stackRestore(u),"string"===o&&d&&i._free(d),f||i._OrtReleaseTensor(r)}}p&&!c&&(0!==i._OrtClearBoundOutputs(p.handle)&&je("Can't clear bound outputs."),lt.set(e,[l,f,d,p,c,!1]));for(let[e,t]of await Promise.all(_))E[e][2]=t;return L("wasm ProcessOutputTensor"),E}finally{i.webnnOnRunEnd?.(l),i.stackRestore(E),g.forEach(e=>i._OrtReleaseTensor(e)),b.forEach(e=>i._OrtReleaseTensor(e)),v.forEach(e=>i._free(e)),0!==m&&i._OrtReleaseRunOptions(m),y.forEach(e=>i._free(e))}},yt=e=>{let t=Fe(),r=lt.get(e);if(!r)throw new Error("invalid session id");let n=r[0],a=t._OrtEndProfiling(n);0===a&&je("Can't get an profile file name."),t._OrtFree(a)},gt=e=>{let t=[];for(let r of e){let e=r[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),Zt=D(()=>{se(),Yt(),Wt(),Gt(),bt=()=>!!l.wasm.proxy&&typeof document<"u",Et=!1,Tt=!1,Ot=!1,_t=new Map,Rt=(e,t)=>{let r=_t.get(e);r?r.push(t):_t.set(e,[t])},Ut=()=>{if(Et||!Tt||Ot||!vt)throw new Error("worker not ready")},It=e=>{switch(e.data.type){case"init-wasm":Et=!1,e.data.err?(Ot=!0,Ct[1](e.data.err)):(Tt=!0,Ct[0]()),At&&(URL.revokeObjectURL(At),At=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=_t.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},xt=async()=>{if(!Tt){if(Et)throw new Error("multiple calls to 'initWasm()' detected.");if(Ot)throw new Error("previous call to 'initWasm()' failed.");if(Et=!0,bt())return new Promise((e,t)=>{vt?.terminate(),Ie().then(([r,n])=>{try{(vt=n).onerror=e=>t(e),vt.onmessage=It,Ct=[e,t];let a={type:"init-wasm",in:l};!a.in.wasm.wasmPaths&&(r||be)&&(a.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.wasm",import.meta.url).href}),vt.postMessage(a),At=r}catch(e){t(e)}},t)});try{await De(l.wasm),await st(l),Tt=!0}catch(e){throw Ot=!0,e}finally{Et=!1}}},Lt=async e=>{if(bt())return Ut(),new Promise((t,r)=>{Rt("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:l}};vt.postMessage(n)});await ut(l,e)},Mt=async e=>bt()?(Ut(),new Promise((t,r)=>{Rt("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};vt.postMessage(n,[e.buffer])})):pt(e),Pt=async(e,t)=>{if(bt()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ut(),new Promise((r,n)=>{Rt("create",[r,n]);let a={type:"create",in:{model:e,options:{...t}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),vt.postMessage(a,o)})}return ct(e,t)},St=async e=>{if(bt())return Ut(),new Promise((t,r)=>{Rt("release",[t,r]);let n={type:"release",in:e};vt.postMessage(n)});ht(e)},$t=async(e,t,r,n,a,o)=>{if(bt()){if(r.some(e=>"cpu"!==e[3]))throw new Error("input tensor on GPU is not supported for proxy.");if(a.some(e=>e))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ut(),new Promise((a,i)=>{Rt("run",[a,i]);let s=r,u={type:"run",in:{sessionId:e,inputIndices:t,inputs:s,outputIndices:n,options:o}};vt.postMessage(u,gt(s))})}return mt(e,t,r,n,a,o)},kt=async e=>{if(bt())return Ut(),new Promise((t,r)=>{Rt("end-profiling",[t,r]);let n={type:"end-profiling",in:e};vt.postMessage(n)});yt(e)}}),Qt=D(()=>{se(),Zt(),zt(),ue(),qt(),Bt=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},Nt=e=>{switch(e[3]){case"cpu":return new C(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!rt(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:a}=e[2];return C.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:a})}case"ml-tensor":{let t=e[0];if(!nt(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:a}=e[2];return C.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:a})}default:throw new Error(`invalid data location: ${e[3]}`)}},Dt=class{async fetchModelAndCopyToWasmMemory(e){return Mt(await ot(e))}async loadModel(e,t){let r;U(),r="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Pt(r,t),I()}async dispose(){return St(this.sessionId)}async run(e,t,r){U();let n=[],a=[];Object.entries(e).forEach(e=>{let t=e[0],r=e[1],o=this.inputNames.indexOf(t);if(-1===o)throw new Error(`invalid input '${t}'`);n.push(r),a.push(o)});let o=[],i=[];Object.entries(t).forEach(e=>{let t=e[0],r=e[1],n=this.outputNames.indexOf(t);if(-1===n)throw new Error(`invalid output '${t}'`);o.push(r),i.push(n)});let s=n.map((e,t)=>Bt(e,()=>`input "${this.inputNames[a[t]]}"`)),u=o.map((e,t)=>e?Bt(e,()=>`output "${this.outputNames[i[t]]}"`):null),l=await $t(this.sessionId,a,s,i,u,r),f={};for(let e=0;e<l.length;e++)f[this.outputNames[i[e]]]=o[e]??Nt(l[e]);return I(),f}startProfiling(){}endProfiling(){kt(this.sessionId)}}}),Xt={};F(Xt,{OnnxruntimeWebAssemblyBackend:()=>Kt,initializeFlags:()=>Jt,wasmBackend:()=>er});var Jt,Kt,er,tr=D(()=>{se(),Zt(),Qt(),Jt=()=>{("number"!=typeof l.wasm.initTimeout||l.wasm.initTimeout<0)&&(l.wasm.initTimeout=0);let e=l.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),l.wasm.simd=!1),"boolean"!=typeof l.wasm.proxy&&(l.wasm.proxy=!1),"boolean"!=typeof l.wasm.trace&&(l.wasm.trace=!1),"number"!=typeof l.wasm.numThreads||!Number.isInteger(l.wasm.numThreads)||l.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)l.wasm.numThreads=1;else{let e=typeof navigator>"u"?N("node:os").cpus().length:navigator.hardwareConcurrency;l.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},er=new(Kt=class{async init(e){Jt(),await xt(),await Lt(e)}async createInferenceSessionHandler(e,t){let r=new Dt;return await r.loadModel(e,t),r}})});se(),se(),se();var rr=ie;{let e=(tr(),G(Xt)).wasmBackend;n("cpu",e,10),n("wasm",e,10)}Object.defineProperty(l.versions,"web",{value:"1.23.0",enumerable:!0});export{P as InferenceSession,_ as TRACE,x as TRACE_EVENT_BEGIN,L as TRACE_EVENT_END,U as TRACE_FUNC_BEGIN,I as TRACE_FUNC_END,C as Tensor,rr as default,l as env,n as registerBackend};