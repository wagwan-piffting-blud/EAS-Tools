/*! For license information please see ort.webgpu.bundle.min.mjs.LICENSE.txt */
var e,t,r,n,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b,v,C,T,_,E,A,x,O,I,S,U,B,R,M,j=Object.defineProperty,L=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,$=Object.prototype.hasOwnProperty,k=(e=function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):e),D=(e,t)=>()=>(e&&(t=e(e=0)),t),N=(e,t)=>{for(var r in t)j(e,r,{get:t[r],enumerable:!0})},W=e=>((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of P(t))!$.call(e,r)&&undefined!==r&&j(e,r,{get:()=>t[r],enumerable:!(n=L(t,r))||n.enumerable});return e})(j({},"__esModule",{value:!0}),e),G=D(()=>{t=new Map,r=[],n=(e,n,i)=>{if(n&&"function"==typeof n.init&&"function"==typeof n.createInferenceSessionHandler){let a=t.get(e);if(void 0===a)t.set(e,{backend:n,priority:i});else{if(a.priority>i)return;if(a.priority===i&&a.backend!==n)throw new Error(`cannot register backend "${e}" using priority ${i}`)}if(i>=0){let n=r.indexOf(e);-1!==n&&r.splice(n,1);for(let n=0;n<r.length;n++)if(t.get(r[n]).priority<=i)return void r.splice(n,0,e);r.push(e)}return}throw new TypeError("not a valid backend")},i=async e=>{let r=t.get(e);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let t=!!r.initPromise;try{return t||(r.initPromise=r.backend.init(e)),await r.initPromise,r.initialized=!0,r.backend}catch(e){return t||(r.error=`${e}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},a=async e=>{let t,n=e.executionProviders||[],a=n.map(e=>"string"==typeof e?e:e.name),o=0===a.length?r:a,s=[],u=new Set;for(let e of o){let r=await i(e);"string"==typeof r?s.push({name:e,err:r}):(t||(t=r),t===r&&u.add(e))}if(!t)throw new Error(`no available backend found. ERR: ${s.map(e=>`[${e.name}] ${e.err}`).join(", ")}`);for(let{name:e,err:t}of s)a.includes(e)&&console.warn(`removing requested execution provider "${e}" from session options because it is not available: ${t}`);let l=n.filter(e=>u.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?l:Reflect.get(e,t)})]}}),F=D(()=>{G()}),V=D(()=>{o="1.23.0"}),z=D(()=>{V(),s="warning",u={wasm:{},webgl:{},webgpu:{},versions:{common:o},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error(`Unsupported logging level: ${e}`);s=e}},get logLevel(){return s}},Object.defineProperty(u,"logLevel",{enumerable:!0})}),H=D(()=>{z(),l=u}),q=D(()=>{f=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(null!=n){let i,a;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[3]):(i=e.dims[3],a=e.dims[2]);let o,s,u=void 0!==t?.format?t.format:"RGB",l=t?.norm;void 0===l||void 0===l.mean?o=[255,255,255,255]:"number"==typeof l.mean?o=[l.mean,l.mean,l.mean,l.mean]:(o=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(o[3]=l.mean[3])),void 0===l||void 0===l.bias?s=[0,0,0,0]:"number"==typeof l.bias?s=[l.bias,l.bias,l.bias,l.bias]:(s=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(s[3]=l.bias[3]));let f=a*i,d=0,p=f,c=2*f,h=-1;"RGBA"===u?(d=0,p=f,c=2*f,h=3*f):"RGB"===u?(d=0,p=f,c=2*f):"RBG"===u&&(d=0,c=f,p=2*f);for(let t=0;t<a;t++)for(let r=0;r<i;r++){let i=(e.data[d++]-s[0])*o[0],a=(e.data[p++]-s[1])*o[1],u=(e.data[c++]-s[2])*o[2],l=-1===h?255:(e.data[h++]-s[3])*o[3];n.fillStyle="rgba("+i+","+a+","+u+","+l+")",n.fillRect(r,t,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},d=(e,t)=>{let r,n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==n)throw new Error("Can not access image data");{let i,a,o;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[1],o=e.dims[3]):(i=e.dims[3],a=e.dims[2],o=e.dims[1]);let s,u,l=void 0!==t&&void 0!==t.format?t.format:"RGB",f=t?.norm;void 0===f||void 0===f.mean?s=[255,255,255,255]:"number"==typeof f.mean?s=[f.mean,f.mean,f.mean,f.mean]:(s=[f.mean[0],f.mean[1],f.mean[2],255],void 0!==f.mean[3]&&(s[3]=f.mean[3])),void 0===f||void 0===f.bias?u=[0,0,0,0]:"number"==typeof f.bias?u=[f.bias,f.bias,f.bias,f.bias]:(u=[f.bias[0],f.bias[1],f.bias[2],0],void 0!==f.bias[3]&&(u[3]=f.bias[3]));let d=a*i;if(void 0!==t&&(void 0!==t.format&&4===o&&"RGBA"!==t.format||3===o&&"RGB"!==t.format&&"BGR"!==t.format))throw new Error("Tensor format doesn't match input tensor dims");let p=4,c=0,h=1,y=2,m=3,w=0,g=d,b=2*d,v=-1;"RGBA"===l?(w=0,g=d,b=2*d,v=3*d):"RGB"===l?(w=0,g=d,b=2*d):"RBG"===l&&(w=0,b=d,g=2*d),r=n.createImageData(i,a);for(let t=0;t<a*i;c+=p,h+=p,y+=p,m+=p,t++)r.data[c]=(e.data[w++]-u[0])*s[0],r.data[h]=(e.data[g++]-u[1])*s[1],r.data[y]=(e.data[b++]-u[2])*s[2],r.data[m]=-1===v?255:(e.data[v++]-u[3])*s[3]}return r}}),Y=D(()=>{Q(),p=(e,t)=>{if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let r,n,{height:i,width:a}=t,o=t.norm??{mean:255,bias:0};r="number"==typeof o.mean?[o.mean,o.mean,o.mean,o.mean]:[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],n="number"==typeof o.bias?[o.bias,o.bias,o.bias,o.bias]:[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let s=void 0!==t.format?t.format:"RGBA",u=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",l=i*a,f="RGBA"===u?new Float32Array(4*l):new Float32Array(3*l),d=4,p=0,c=1,h=2,y=3,m=0,w=l,g=2*l,b=-1;"RGB"===s&&(d=3,p=0,c=1,h=2,y=-1),"RGBA"===u?b=3*l:"RBG"===u?(m=0,g=l,w=2*l):"BGR"===u&&(g=0,w=l,m=2*l);for(let t=0;t<l;t++,p+=d,h+=d,c+=d,y+=d)f[m++]=(e[p]+n[0])/r[0],f[w++]=(e[c]+n[1])/r[1],f[g++]=(e[h]+n[2])/r[2],-1!==b&&-1!==y&&(f[b++]=(e[y]+n[3])/r[3]);return new E("float32",f,"RGBA"===u?[1,4,i,a]:[1,3,i,a])},c=async(e,t)=>{let r,n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,i=typeof ImageData<"u"&&e instanceof ImageData,a=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o="string"==typeof e,s=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=e=>typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(n){let n=u();n.width=e.width,n.height=e.height;let i=l(n);if(null==i)throw new Error("Can not access image data");{let n=e.height,a=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(n=t.resizedHeight,a=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=n,s.width=a}else s.tensorFormat="RGBA",s.height=n,s.width=a;i.drawImage(e,0,0),r=i.getImageData(0,0,a,n).data}}else{if(!i){if(a){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");let n=u();n.width=e.width,n.height=e.height;let i=l(n);if(null!=i){let t=e.height,n=e.width;return i.drawImage(e,0,0,n,t),r=i.getImageData(0,0,n,t).data,s.height=t,s.width=n,p(r,s)}throw new Error("Can not access image data")}if(o)return new Promise((t,r)=>{let n=u(),i=l(n);if(!e||!i)return r();let a=new Image;a.crossOrigin="Anonymous",a.src=e,a.onload=()=>{n.width=a.width,n.height=a.height,i.drawImage(a,0,0,n.width,n.height);let e=i.getImageData(0,0,n.width,n.height);s.height=n.height,s.width=n.width,t(p(e.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let n,i;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(n=t.resizedHeight,i=t.resizedWidth):(n=e.height,i=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=n,s.width=i,void 0!==t){let t=u();t.width=i,t.height=n;let a=l(t);if(null==a)throw new Error("Can not access image data");a.putImageData(e,0,0),r=a.getImageData(0,0,i,n).data}else r=e.data}}if(void 0!==r)return p(r,s);throw new Error("Input data provided is not supported - aborted tensor creation")},h=(e,t)=>{let{width:r,height:n,download:i,dispose:a}=t;return new E({location:"texture",type:"float32",texture:e,dims:[1,n,r,4],download:i,dispose:a})},y=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new E({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:i,dispose:a})},m=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new E({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:i,dispose:a})},w=(e,t,r)=>new E({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),Z=D(()=>{g=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),b=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),v=!1,C=()=>{if(!v){v=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(g.set("int64",BigInt64Array),b.set(BigInt64Array,"int64")),t&&(g.set("uint64",BigUint64Array),b.set(BigUint64Array,"uint64")),n?(g.set("float16",r),b.set(r,"float16")):g.set("float16",Uint16Array)}}}),X=D(()=>{Q(),T=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if("number"!=typeof n||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},_=(e,t)=>{switch(e.location){case"cpu":return new E(e.type,e.data,t);case"cpu-pinned":return new E({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new E({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new E({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new E({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),Q=D(()=>{q(),Y(),Z(),X(),E=class{constructor(e,t,r){let n,i;if(C(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,n=e.type,i=e.dims,e.location){case"cpu-pinned":{let t=g.get(n);if(!t)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof t))throw new TypeError(`buffer should be of type ${t.name}`);this.cpuData=e.data;break}case"texture":if("float32"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint64"!==n&&"int8"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if("string"==typeof e)if(n=e,o=r,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");a=t}else{let r=g.get(e);if(void 0===r)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if("float16"===e&&r===Uint16Array||"uint4"===e||"int4"===e)throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${r.name} as data.`);a="uint64"===e||"int64"===e?r.from(t,BigInt):r.from(t)}else if(t instanceof r)a=t;else if(t instanceof Uint8ClampedArray){if("uint8"!==e)throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");a=Uint8Array.from(t)}else{if(!("float16"===e&&t instanceof Uint16Array&&r!==Uint16Array))throw new TypeError(`A ${n} tensor's data must be type of ${r}`);a=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length)}}else if(o=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)n="string",a=e;else{if("boolean"!==t)throw new TypeError(`Invalid element type of data array: ${t}.`);n="bool",a=Uint8Array.from(e)}}else if(e instanceof Uint8ClampedArray)n="uint8",a=Uint8Array.from(e);else{let t=b.get(e.constructor);if(void 0===t)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=t,a=e}if(void 0===o)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=a,this.dataLocation="cpu"}let a=T(i);if(this.cpuData&&a!==this.cpuData.length&&("uint4"!==n&&"int4"!==n||Math.ceil(a/2)!==this.cpuData.length))throw new Error(`Tensor's size(${a}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=i,this.size=a}static async fromImage(e,t){return c(e,t)}static fromTexture(e,t){return h(e,t)}static fromGpuBuffer(e,t){return y(e,t)}static fromMLTensor(e,t){return m(e,t)}static fromPinnedBuffer(e,t,r){return w(e,t,r)}toDataURL(e){return f(this,e)}toImageData(e){return d(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return _(this,e)}}}),J=D(()=>{Q(),A=E}),K=D(()=>{z(),x=(e,t)=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.timeStamp(`${e}::ORT::${t}`)},O=(e,t)=>{let r=(new Error).stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let n=`FUNC_${e}::${r[i].trim().split(" ")[1]}`;return t&&(n+=`::${t}`),void x("CPU",n)}r[i].includes("TRACE_FUNC")&&(n=!0)}},I=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||O("BEGIN",e)},S=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||O("END",e)},U=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.time(`ORT::${e}`)},B=e=>{(typeof u.trace>"u"?!u.wasm.trace:!u.trace)||console.timeEnd(`ORT::${e}`)}}),ee=D(()=>{G(),J(),K(),R=class e{constructor(e){this.handler=e}async run(e,t,r){I(),U("InferenceSession.run");let n={},i={};if("object"!=typeof e||null===e||e instanceof A||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof A)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError(`'fetches' contains invalid output name: ${e}.`);n[e]=null}if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let e=!1,o=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==o.indexOf(r)){let i=t[r];(null===i||i instanceof A)&&(e=!0,a=!1,n[r]=i)}if(e){if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else i=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(typeof e[t]>"u")throw new Error(`input '${t}' is missing in 'feeds'.`);if(a)for(let e of this.outputNames)n[e]=null;let o=await this.handler.run(e,n,i),s={};for(let e in o)if(Object.hasOwnProperty.call(o,e)){let t=o[e];s[e]=t instanceof A?t:new A(t.type,t.data,t.dims)}return B("InferenceSession.run"),S(),s}async release(){return this.handler.dispose()}static async create(t,r,n,i){I(),U("InferenceSession.create");let o,s={};if("string"==typeof t){if(o=t,"object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,"object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{if(!(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let e=t,a=0,u=t.byteLength;if("object"==typeof r&&null!==r)s=r;else if("number"==typeof r){if(a=r,!Number.isSafeInteger(a))throw new RangeError("'byteOffset' must be an integer.");if(a<0||a>=e.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${e.byteLength}).`);if(u=t.byteLength-a,"number"==typeof n){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||a+u>e.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${e.byteLength-a}].`);if("object"==typeof i&&null!==i)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(e,a,u)}}let[u,l]=await a(s),f=await u.createInferenceSessionHandler(o,l);return B("InferenceSession.create"),S(),new e(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),te=D(()=>{ee(),M=R}),re=D(()=>{}),ne=D(()=>{}),ie=D(()=>{}),ae=D(()=>{}),oe={};N(oe,{InferenceSession:()=>M,TRACE:()=>x,TRACE_EVENT_BEGIN:()=>U,TRACE_EVENT_END:()=>B,TRACE_FUNC_BEGIN:()=>I,TRACE_FUNC_END:()=>S,Tensor:()=>A,env:()=>l,registerBackend:()=>n});var se=D(()=>{F(),H(),te(),J(),re(),ne(),K(),ie(),ae()}),ue=D(()=>{}),le={};N(le,{default:()=>pe});var fe,de,pe,ce=D(()=>{Tr(),It(),Ot(),fe="ort-wasm-proxy-worker",(de=globalThis.self?.name===fe)&&(self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":De(r.wasm).then(()=>{Gt(r).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:n}=r;Ft(n,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=r,n=qt(e);postMessage({type:t,out:n});break}case"create":{let{model:e,options:n}=r;Yt(e,n).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":Zt(r),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:n,inputs:i,outputIndices:a,options:o}=r;Qt(e,n,i,a,new Array(a.length).fill(null),o).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},Kt([...i,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":Jt(r),postMessage({type:t})}}catch(e){postMessage({type:t,err:e})}}),pe=de?null:e=>new Worker(e??Ce,{type:"module",name:fe})}),he={};N(he,{default:()=>me});var ye,me,we,ge,be,ve,Ce,Te,_e,Ee,Ae,xe,Oe,Ie,Se,Ue,Be,Re,Me,je,Le,Pe,$e,ke,De,Ne,We,Ge,Fe,Ve,ze,He,qe,Ye,Ze,Xe,Qe,Je,Ke,et,tt,rt,nt,it,at,ot,st,ut,lt,ft,dt,pt,ct,ht,yt,mt,wt,gt,bt,vt,Ct,Tt,_t,Et,At,xt=D(()=>{ye=async function(e={}){var t,r,n=e,i=new Promise((e,n)=>{t=e,r=n}),a="object"==typeof window,o=typeof WorkerGlobalScope<"u",s=o&&self.name?.startsWith("em-pthread");n.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(n.fc||(n.fc=new Map)).set(e,t)},n.unmountExternalData=()=>{delete n.fc};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let l=()=>{let e=(e,t,r)=>(...n)=>{let i=$t,a=t?.();n=e(...n);let o=t?.();return a!==o&&(e=o,r(a),t=r=null),$t!=i?new Promise((e,t)=>{Ft={resolve:e,reject:t}}):n};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[t]=e(n[t],()=>n[t],e=>n[t]=e)})(),typeof jsepRunAsync<"u"&&(n._OrtRun=jsepRunAsync(n._OrtRun),n._OrtRunWithBinding=jsepRunAsync(n._OrtRunWithBinding)),l=void 0};n.asyncInit=()=>{l?.()};var f,d,p=(e,t)=>{throw t},c=import.meta.url,h="";if(a||o){try{h=new URL(".",c).href}catch{}o&&(d=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),f=async e=>{if(L(e))return new Promise((t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r(n.status)},n.onerror=r,n.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var y,m,w,g,b,v,C,T,_,E,A,x,O,I,S,U=console.log.bind(console),B=console.error.bind(console),R=U,M=B,j=!1,L=e=>e.startsWith("file://");function P(){return m.buffer!=b.buffer&&z(),b}function $(){return m.buffer!=b.buffer&&z(),v}function k(){return m.buffer!=b.buffer&&z(),C}function D(){return m.buffer!=b.buffer&&z(),T}function N(){return m.buffer!=b.buffer&&z(),_}function W(){return m.buffer!=b.buffer&&z(),E}function G(){return m.buffer!=b.buffer&&z(),A}function F(){return m.buffer!=b.buffer&&z(),I}if(s){let e=function(t){try{var r=t.data,i=r.dc;if("load"===i){let t=[];self.onmessage=e=>t.push(e),self.startWorker=()=>{postMessage({dc:"loaded"});for(let r of t)e(r);self.onmessage=e};for(let e of r.Uc)n[e]&&!n[e].proxy||(n[e]=(...t)=>{postMessage({dc:"callHandler",Tc:e,args:t})},"print"==e&&(R=n[e]),"printErr"==e&&(M=n[e]));m=r.bd,z(),S(r.cd)}else if("run"===i){me(r.ac),Pi(r.ac,0,0,1,0,0),ce(),_t(r.ac),V||(ci(),V=!0);try{we(r.Zc,r.jc)}catch(e){if("unwind"!=e)throw e}}else"setimmediate"!==r.target&&("checkMailbox"===i?V&&Et():i&&(M(`worker: received unknown command ${i}`),M(r)))}catch(e){throw $i(),e}};var V=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=e}function z(){var e=m.buffer;n.HEAP8=b=new Int8Array(e),C=new Int16Array(e),n.HEAPU8=v=new Uint8Array(e),T=new Uint16Array(e),n.HEAP32=_=new Int32Array(e),n.HEAPU32=E=new Uint32Array(e),A=new Float32Array(e),I=new Float64Array(e),x=new BigInt64Array(e),O=new BigUint64Array(e)}function H(){s?startWorker(n):di.nb()}var q,Y=0,Z=null;function X(){if(0==--Y&&Z){var e=Z;Z=null,e()}}function Q(e){throw M(e="Aborted("+e+")"),j=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function J(){return{a:{R:fi,b:ve,ba:Te,I:xe,ra:Oe,jb:Ie,lb:Se,sa:Ue,pa:Be,ia:Re,oa:Me,P:je,kb:Le,hb:Pe,qa:$e,ib:ke,xa:Ne,Z:Ye,cb:Xe,ab:it,Y:ot,w:st,t:ut,bb:dt,L:bt,db:vt,la:Ct,fb:At,ca:Ot,_a:It,$:St,ka:_t,ua:Ut,s:Mt,Na:jt,A:Ht,o:Yt,m:Qt,c:Ke,Ma:Jt,n:er,i:nr,v:ir,p:ar,f:or,u:sr,k:ur,e:lr,j:fr,h:dr,g:pr,d:cr,fa:hr,ga:gr,ha:br,da:vr,ea:Cr,$a:Er,za:Ar,wa:Ir,E:Br,La:Rr,M:Mr,va:xr,C:jr,ta:Lr,gb:Pr,r:_r,Ia:$r,F:kr,Q:Dr,eb:Nr,Ba:Vr,Aa:zr,Ha:dn,q:pn,U:hn,T:yn,Ka:mn,D:wn,l:gn,Ga:bn,Fa:vn,Ja:Cn,Ea:Tn,Da:_n,Ca:En,ma:In,na:Sn,aa:se,J:Un,O:Bn,ja:Rn,N:jn,a:m,ya:ae,Xa:Ln,K:Pn,x:$n,S:kn,Ya:Dn,y:Nn,Ta:Wn,Va:Gn,V:Fn,z:Vn,_:zn,W:Hn,G:qn,Ra:Yn,mb:Zn,B:Xn,Ua:Qn,Wa:Jn,Oa:Kn,Pa:ei,Qa:ti,H:ri,X:ni,Sa:ii,Za:ai}}}class K{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var ee=e=>{e.terminate(),e.onmessage=()=>{}},te=[],re=e=>{0==ue.length&&(ye(),he(ue[0]));var t=ue.pop();if(!t)return 6;le.push(t),de[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},ne=0,ie=(e,t,...r)=>{for(var n=2*r.length,i=qi(),a=Hi(8*n),o=a>>>3,s=0;s<r.length;s++){var u=r[s];"bigint"==typeof u?(x[o+2*s]=1n,x[o+2*s+1]=u):(x[o+2*s]=0n,F()[o+2*s+1>>>0]=u)}return e=ki(e,0,n,a,t),zi(i),e};function ae(e){if(s)return ie(0,1,e);if(g=e,!(0<ne)){for(var t of le)ee(t);for(t of ue)ee(t);ue=[],le=[],de={},j=!0}p(0,new K(e))}function oe(e){if(s)return ie(1,0,e);se(e)}var se=e=>{if(g=e,s)throw oe(e),"unwind";ae(e)},ue=[],le=[],fe=[],de={},pe=e=>{var t=e.ac;delete de[t],ue.push(e),le.splice(le.indexOf(e),1),e.ac=0,Di(t)};function ce(){fe.forEach(e=>e())}var he=e=>new Promise(t=>{e.onmessage=r=>{var i=(r=r.data).dc;if(r.hc&&r.hc!=yi()){var a=de[r.hc];a?a.postMessage(r,r.Oc):M(`Internal error! Worker sent a message "${i}" to target pthread ${r.hc}, but that thread no longer exists!`)}else"checkMailbox"===i?Et():"spawnThread"===i?re(r):"cleanupThread"===i?pe(de[r.$c]):"loaded"===i?(e.loaded=!0,t(e)):"setimmediate"===r.target?e.postMessage(r):"callHandler"===i?n[r.Tc](...r.args):i&&M(`worker sent an unknown command ${i}`)},e.onerror=e=>{throw M(`worker sent an error! ${e.filename}:${e.lineno}: ${e.message}`),e};var r,i=[];for(r of[])n.propertyIsEnumerable(r)&&i.push(r);e.postMessage({dc:"load",Uc:i,bd:m,cd:w})});function ye(){var e=new Worker((()=>{let e=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new e("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ue.push(e)}var me=e=>{z();var t=W()[e+52>>>2>>>0];e=W()[e+56>>>2>>>0],Vi(t,t-e),zi(t)},we=(e,t)=>{ne=0,e=Yi(e,t),0<ne?g=e:Ni(e)};class ge{constructor(e){this.ic=e-24}}var be=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function ve(e,t,r){var n=new ge(e>>>=0);throw t>>>=0,r>>>=0,W()[n.ic+16>>>2>>>0]=0,W()[n.ic+4>>>2>>>0]=t,W()[n.ic+8>>>2>>>0]=r,e}function Ce(e,t,r,n){return s?ie(2,1,e,t,r,n):Te(e,t,r,n)}function Te(e,t,r,n){if(e>>>=0,r>>>=0,n>>>=0,void 0===u)return 6;var i=[];return s&&0===i.length?Ce(e,t>>>=0,r,n):(e={Yc:r,ac:e,jc:n,Oc:i},s?(e.dc="spawnThread",postMessage(e,i),0):re(e))}var _e=typeof TextDecoder<"u"?new TextDecoder:void 0,Ee=(e,t=0,r=NaN)=>{var n=(t>>>=0)+r;for(r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&_e)return _e.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(n="";t<r;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},Ae=(e,t)=>(e>>>=0)?Ee($(),e,t):"";function xe(e,t,r){return s?ie(3,1,e,t,r):0}function Oe(e,t){if(s)return ie(4,1,e,t)}function Ie(e,t){if(s)return ie(5,1,e,t)}function Se(e,t,r){if(s)return ie(6,1,e,t,r)}function Ue(e,t,r){return s?ie(7,1,e,t,r):0}function Be(e,t){if(s)return ie(8,1,e,t)}function Re(e,t,r){if(s)return ie(9,1,e,t,r)}function Me(e,t,r,n){if(s)return ie(10,1,e,t,r,n)}function je(e,t,r,n){if(s)return ie(11,1,e,t,r,n)}function Le(e,t,r,n){if(s)return ie(12,1,e,t,r,n)}function Pe(e){if(s)return ie(13,1,e)}function $e(e,t){if(s)return ie(14,1,e,t)}function ke(e,t,r){if(s)return ie(15,1,e,t,r)}var De,Ne=()=>Q(""),We=e=>{for(var t="";$()[e>>>0];)t+=De[$()[e++>>>0]];return t},Ge={},Fe={},Ve={},ze=n.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function He(e,t,r={}){return function(e,t,r={}){var n=t.name;if(!e)throw new ze(`type "${n}" must have a positive integer typeid pointer`);if(Fe.hasOwnProperty(e)){if(r.Vc)return;throw new ze(`Cannot register type '${n}' twice`)}Fe[e]=t,delete Ve[e],Ge.hasOwnProperty(e)&&(t=Ge[e],delete Ge[e],t.forEach(e=>e()))}(e,t,r)}var qe=(e,t,r)=>{switch(t){case 1:return r?e=>P()[e>>>0]:e=>$()[e>>>0];case 2:return r?e=>k()[e>>>1>>>0]:e=>D()[e>>>1>>>0];case 4:return r?e=>N()[e>>>2>>>0]:e=>W()[e>>>2>>>0];case 8:return r?e=>x[e>>>3]:e=>O[e>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Ye(e,t,r){r>>>=0,He(e>>>=0,{name:t=We(t>>>0),fromWireType:e=>e,toWireType:function(e,t){if("bigint"!=typeof t&&"number"!=typeof t)throw t=null===t?"null":"object"==(e=typeof t)||"array"===e||"function"===e?t.toString():""+t,new TypeError(`Cannot convert "${t}" to ${this.name}`);return"number"==typeof t&&(t=BigInt(t)),t},cc:Ze,readValueFromPointer:qe(t,r,-1==t.indexOf("u")),ec:null})}var Ze=8;function Xe(e,t,r,n){He(e>>>=0,{name:t=We(t>>>0),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:n},cc:Ze,readValueFromPointer:function(e){return this.fromWireType($()[e>>>0])},ec:null})}var Qe=[],Je=[];function Ke(e){9<(e>>>=0)&&0==--Je[e+1]&&(Je[e]=void 0,Qe.push(e))}var et=e=>{if(!e)throw new ze(`Cannot use deleted val. handle = ${e}`);return Je[e]},tt=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Qe.pop()||Je.length;return Je[t]=e,Je[t+1]=1,t}};function rt(e){return this.fromWireType(W()[e>>>2>>>0])}var nt={name:"emscripten::val",fromWireType:e=>{var t=et(e);return Ke(e),t},toWireType:(e,t)=>tt(t),cc:Ze,readValueFromPointer:rt,ec:null};function it(e){return He(e>>>0,nt)}var at=(e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(G()[e>>>2>>>0])};case 8:return function(e){return this.fromWireType(F()[e>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function ot(e,t,r){r>>>=0,He(e>>>=0,{name:t=We(t>>>0),fromWireType:e=>e,toWireType:(e,t)=>t,cc:Ze,readValueFromPointer:at(t,r),ec:null})}function st(e,t,r,n,i){if(e>>>=0,r>>>=0,t=We(t>>>0),-1===i&&(i=4294967295),i=e=>e,0===n){var a=32-8*r;i=e=>e<<a>>>a}var o=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t};He(e,{name:t,fromWireType:i,toWireType:o,cc:Ze,readValueFromPointer:qe(t,r,0!==n),ec:null})}function ut(e,t,r){function n(e){var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],new i(P().buffer,e,t)}var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];He(e>>>=0,{name:r=We(r>>>0),fromWireType:n,cc:Ze,readValueFromPointer:n},{Vc:!0})}var lt=(e,t,r)=>{var n=$();if(t>>>=0,0<r){var i=t;r=t+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(t>=r)break;n[t++>>>0]=o}else{if(2047>=o){if(t+1>=r)break;n[t++>>>0]=192|o>>6}else{if(65535>=o){if(t+2>=r)break;n[t++>>>0]=224|o>>12}else{if(t+3>=r)break;n[t++>>>0]=240|o>>18,n[t++>>>0]=128|o>>12&63}n[t++>>>0]=128|o>>6&63}n[t++>>>0]=128|63&o}}n[t>>>0]=0,e=t-i}else e=0;return e},ft=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}return t};function dt(e,t){He(e>>>=0,{name:t=We(t>>>0),fromWireType:function(e){for(var t,r=W()[e>>>2>>>0],n=e+4,i=n,a=0;a<=r;++a){var o=n+a;a!=r&&0!=$()[o>>>0]||(i=Ae(i,o-i),void 0===t?t=i:(t+="\0",t+=i),i=o+1)}return mi(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;if(!(r||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT))throw new ze("Cannot pass non-string to std::string");var n=r?ft(t):t.length,i=wi(4+n+1),a=i+4;return W()[i>>>2>>>0]=n,r?lt(t,a,n+1):$().set(t,a>>>0),null!==e&&e.push(mi,i),i},cc:Ze,readValueFromPointer:rt,ec(e){mi(e)}})}var pt=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ct=(e,t)=>{for(var r=e>>1,n=r+t/2;!(r>=n)&&D()[r>>>0];)++r;if(32<(r<<=1)-e&&pt)return pt.decode($().slice(e,r));for(r="",n=0;!(n>=t/2);++n){var i=k()[e+2*n>>>1>>>0];if(0==i)break;r+=String.fromCharCode(i)}return r},ht=(e,t,r)=>{if(r??=2147483647,2>r)return 0;var n=t;r=(r-=2)<2*e.length?r/2:e.length;for(var i=0;i<r;++i){var a=e.charCodeAt(i);k()[t>>>1>>>0]=a,t+=2}return k()[t>>>1>>>0]=0,t-n},yt=e=>2*e.length,mt=(e,t)=>{for(var r=0,n="";!(r>=t/4);){var i=N()[e+4*r>>>2>>>0];if(0==i)break;++r,65536<=i?(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i)):n+=String.fromCharCode(i)}return n},wt=(e,t,r)=>{if(t>>>=0,r??=2147483647,4>r)return 0;var n=t;r=n+r-4;for(var i=0;i<e.length;++i){var a=e.charCodeAt(i);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),N()[t>>>2>>>0]=a,(t+=4)+4>r)break}return N()[t>>>2>>>0]=0,t-n},gt=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&++r,t+=4}return t};function bt(e,t,r){if(e>>>=0,t>>>=0,r=We(r>>>=0),2===t)var n=ct,i=ht,a=yt,o=e=>D()[e>>>1>>>0];else 4===t&&(n=mt,i=wt,a=gt,o=e=>W()[e>>>2>>>0]);He(e,{name:r,fromWireType:e=>{for(var r,i=W()[e>>>2>>>0],a=e+4,s=0;s<=i;++s){var u=e+4+s*t;s!=i&&0!=o(u)||(a=n(a,u-a),void 0===r?r=a:(r+="\0",r+=a),a=u+t)}return mi(e),r},toWireType:(e,n)=>{if("string"!=typeof n)throw new ze(`Cannot pass non-string to C++ string type ${r}`);var o=a(n),s=wi(4+o+t);return W()[s>>>2>>>0]=o/t,i(n,s+4,o+t),null!==e&&e.push(mi,s),s},cc:Ze,readValueFromPointer:rt,ec(e){mi(e)}})}function vt(e,t){He(e>>>=0,{Wc:!0,name:t=We(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function Ct(e){Pi(e>>>0,!o,1,!a,131072,!1),ce()}var Tt=e=>{if(!j)try{if(e(),!(0<ne))try{s?Ni(g):se(g)}catch(e){e instanceof K||"unwind"==e||p(0,e)}}catch(e){e instanceof K||"unwind"==e||p(0,e)}};function _t(e){e>>>=0,"function"==typeof Atomics.ad&&(Atomics.ad(N(),e>>>2,e).value.then(Et),e+=128,Atomics.store(N(),e>>>2,1))}var Et=()=>{var e=yi();e&&(_t(e),Tt(Gi))};function At(e,t){(e>>>=0)==t>>>0?setTimeout(Et):s?postMessage({hc:e,dc:"checkMailbox"}):(e=de[e])&&e.postMessage({dc:"checkMailbox"})}var xt=[];function Ot(e,t,r,n,i){for(t>>>=0,n/=2,xt.length=n,r=i>>>0>>>3,i=0;i<n;i++)xt[i]=x[r+2*i]?x[r+2*i+1]:F()[r+2*i+1>>>0];return(t?li[t]:ui[e])(...xt)}var It=()=>{ne=0};function St(e){e>>>=0,s?postMessage({dc:"cleanupThread",$c:e}):pe(de[e])}function Ut(e){}var Bt=(e,t)=>{var r=Fe[e];if(void 0===r)throw e=pi(e),r=We(e),mi(e),new ze(`${t} has unknown type ${r}`);return r},Rt=(e,t,r)=>{var n=[];return e=e.toWireType(n,r),n.length&&(W()[t>>>2>>>0]=tt(n)),e};function Mt(e,t,r){return t>>>=0,r>>>=0,e=et(e>>>0),t=Bt(t,"emval::as"),Rt(t,r,e)}function jt(e,t){return t>>>=0,e=et(e>>>0),(t=Bt(t,"emval::as")).toWireType(null,e)}var Lt=e=>{try{e()}catch(e){Q(e)}},Pt=0,$t=null,kt=0,Dt=[],Nt={},Wt={},Gt=0,Ft=null,Vt=[];function zt(e){return function(){if(!j){if(0===Pt){var t=!1,r=!1;e().then((e=0)=>{if(!j&&(kt=e,t=!0,r)){Pt=2,Lt(()=>Qi($t)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),e=!1;try{var n=(o=N()[$t+8>>>2>>>0],o=di[Wt[o]],--ne,o())}catch(o){n=o,e=!0}var i=!1;if(!$t){var a=Ft;a&&(Ft=null,(e?a.reject:a.resolve)(n),i=!0)}if(e&&!i)throw n}var o}),r=!0,t||(Pt=1,$t=function(){var e=wi(65548),t=e+12;W()[e>>>2>>>0]=t,W()[e+4>>>2>>>0]=t+65536,t=Dt[0];var r=Nt[t];return void 0===r&&(r=Gt++,Nt[t]=r,Wt[r]=t),t=r,N()[e+8>>>2>>>0]=t,e}(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Lt(()=>Zi($t)))}else 2===Pt?(Pt=0,Lt(Ji),mi($t),$t=null,Vt.forEach(Tt)):Q(`invalid state: ${Pt}`);return kt}}()}function Ht(e){return e>>>=0,zt(async()=>{var t=await et(e);return tt(t)})}var qt=[];function Yt(e,t,r,n){return r>>>=0,n>>>=0,(e=qt[e>>>0])(null,t=et(t>>>0),r,n)}var Zt={},Xt=e=>{var t=Zt[e];return void 0===t?We(e):t};function Qt(e,t,r,n,i){return r>>>=0,n>>>=0,i>>>=0,(e=qt[e>>>0])(t=et(t>>>0),t[r=Xt(r)],n,i)}function Jt(e,t){return t>>>=0,(e=et(e>>>0))==et(t)}var Kt=()=>"object"==typeof globalThis?globalThis:Function("return this")();function er(e){return 0==(e>>>=0)?tt(Kt()):(e=Xt(e),tt(Kt()[e]))}var tr=e=>{var t=qt.length;return qt.push(e),t},rr=(e,t)=>{for(var r=Array(e),n=0;n<e;++n)r[n]=Bt(W()[t+4*n>>>2>>>0],`parameter ${n}`);return r};function nr(e,t,r){var n=(t=rr(e,t>>>0)).shift();e--;var i="return function (obj, func, destructorsRef, args) {\n",a=0,o=[];0===r&&o.push("obj");for(var s=["retType"],u=[n],l=0;l<e;++l)o.push(`arg${l}`),s.push(`argType${l}`),u.push(t[l]),i+=`  var arg${l} = argType${l}.readValueFromPointer(args${a?"+"+a:""});\n`,a+=t[l].cc;return i+=`  var rv = ${1===r?"new func":"func.call"}(${o.join(", ")});\n`,n.Wc||(s.push("emval_returnValue"),u.push(Rt),i+="  return emval_returnValue(retType, destructorsRef, rv);\n"),e=new Function(...s,i+"};\n")(...u),r=`methodCaller<(${t.map(e=>e.name).join(", ")}) => ${n.name}>`,tr(Object.defineProperty(e,"name",{value:r}))}function ir(e){return e=Xt(e>>>0),tt(n[e])}function ar(e,t){return t>>>=0,e=et(e>>>0),t=et(t),tt(e[t])}function or(e){9<(e>>>=0)&&(Je[e+1]+=1)}function sr(){return tt([])}function ur(e){e=et(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return tt(t)}function lr(e){return tt(Xt(e>>>0))}function fr(){return tt({})}function dr(e){for(var t=et(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}Ke(e)}function pr(e,t,r){t>>>=0,r>>>=0,e=et(e>>>0),t=et(t),r=et(r),e[t]=r}function cr(e,t){return t>>>=0,e=(e=Bt(e>>>0,"_emval_take_value")).readValueFromPointer(t),tt(e)}function hr(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getUTCSeconds(),N()[t+4>>>2>>>0]=e.getUTCMinutes(),N()[t+8>>>2>>>0]=e.getUTCHours(),N()[t+12>>>2>>>0]=e.getUTCDate(),N()[t+16>>>2>>>0]=e.getUTCMonth(),N()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,N()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,N()[t+28>>>2>>>0]=e}var yr=e=>e%4==0&&(e%100!=0||e%400==0),mr=[0,31,60,91,121,152,182,213,244,274,305,335],wr=[0,31,59,90,120,151,181,212,243,273,304,334];function gr(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getSeconds(),N()[t+4>>>2>>>0]=e.getMinutes(),N()[t+8>>>2>>>0]=e.getHours(),N()[t+12>>>2>>>0]=e.getDate(),N()[t+16>>>2>>>0]=e.getMonth(),N()[t+20>>>2>>>0]=e.getFullYear()-1900,N()[t+24>>>2>>>0]=e.getDay();var r=(yr(e.getFullYear())?mr:wr)[e.getMonth()]+e.getDate()-1|0;N()[t+28>>>2>>>0]=r,N()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var n=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r)),N()[t+32>>>2>>>0]=e}function br(e){e>>>=0;var t=new Date(N()[e+20>>>2>>>0]+1900,N()[e+16>>>2>>>0],N()[e+12>>>2>>>0],N()[e+8>>>2>>>0],N()[e+4>>>2>>>0],N()[e>>>2>>>0],0),r=N()[e+32>>>2>>>0],n=t.getTimezoneOffset(),i=new Date(t.getFullYear(),6,1).getTimezoneOffset(),a=new Date(t.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(a,i);return 0>r?N()[e+32>>>2>>>0]=+(i!=a&&o==n):0<r!=(o==n)&&(i=Math.max(a,i),t.setTime(t.getTime()+6e4*((0<r?o:i)-n))),N()[e+24>>>2>>>0]=t.getDay(),r=(yr(t.getFullYear())?mr:wr)[t.getMonth()]+t.getDate()-1|0,N()[e+28>>>2>>>0]=r,N()[e>>>2>>>0]=t.getSeconds(),N()[e+4>>>2>>>0]=t.getMinutes(),N()[e+8>>>2>>>0]=t.getHours(),N()[e+12>>>2>>>0]=t.getDate(),N()[e+16>>>2>>>0]=t.getMonth(),N()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function vr(e,t,r,n,i,a,o){return s?ie(16,1,e,t,r,n,i,a,o):-52}function Cr(e,t,r,n,i,a){if(s)return ie(17,1,e,t,r,n,i,a)}var Tr={},_r=()=>performance.timeOrigin+performance.now();function Er(e,t){if(s)return ie(18,1,e,t);if(Tr[e]&&(clearTimeout(Tr[e].id),delete Tr[e]),!t)return 0;var r=setTimeout(()=>{delete Tr[e],Tt(()=>Wi(e,performance.timeOrigin+performance.now()))},t);return Tr[e]={id:r,nd:t},0}function Ar(e,t,r,n){e>>>=0,t>>>=0,r>>>=0,n>>>=0;var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset();var o=Math.max(a,i);W()[e>>>2>>>0]=60*o,N()[t>>>2>>>0]=+(a!=i),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(a),t=t(i),i<a?(lt(e,r,17),lt(t,n,17)):(lt(e,n,17),lt(t,r,17))}var xr=()=>Date.now(),Or=1;function Ir(e,t,r){if(!(0<=e&&3>=e))return 28;if(0===e)e=Date.now();else{if(!Or)return 52;e=performance.timeOrigin+performance.now()}return x[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var Sr=[],Ur=(e,t)=>{Sr.length=0;for(var r;r=$()[e++>>>0];){var n=105!=r;t+=(n&=112!=r)&&t%8?4:0,Sr.push(112==r?W()[t>>>2>>>0]:106==r?x[t>>>3]:105==r?N()[t>>>2>>>0]:F()[t>>>3>>>0]),t+=n?8:4}return Sr};function Br(e,t,r){return e>>>=0,t=Ur(t>>>0,r>>>0),li[e](...t)}function Rr(e,t,r){return e>>>=0,t=Ur(t>>>0,r>>>0),li[e](...t)}var Mr=()=>{};function jr(e,t){return M(Ae(e>>>0,t>>>0))}var Lr=()=>{throw ne+=1,"unwind"};function Pr(){return 4294901760}var $r=()=>1,kr=()=>navigator.hardwareConcurrency;function Dr(){return Q("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Nr(e){e>>>=0;var t=$().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);e:{n=(Math.min(4294901760,65536*Math.ceil(Math.max(e,n)/65536))-m.buffer.byteLength+65535)/65536|0;try{m.grow(n),z();var i=1;break e}catch{}i=void 0}if(i)return!0}return!1}var Wr=()=>(Q("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Gr={},Fr=e=>{e.forEach(e=>{var t=Wr();t&&(Gr[t]=e)})};function Vr(){var e=Error().stack.toString().split("\n");return"Error"==e[0]&&e.shift(),Fr(e),Gr.oc=Wr(),Gr.Xc=e,Gr.oc}function zr(e,t,r){if(e>>>=0,t>>>=0,Gr.oc==e)var n=Gr.Xc;else"Error"==(n=Error().stack.toString().split("\n"))[0]&&n.shift(),Fr(n);for(var i=3;n[i]&&Wr()!=e;)++i;for(e=0;e<r&&n[e+i];++e)N()[t+4*e>>>2>>>0]=Wr();return e}var Hr=e=>{var t=ft(e)+1,r=Hi(t);return lt(e,r,t),r},qr=[],Yr=(e,t)=>{qr[e>>>=0]=t},Zr=[],Xr=[],Qr=(e,t)=>{Xr[e]=new Promise(r=>t.finally(()=>r(e)))},Jr=e=>{if(e)return qr[e>>>0]},Kr=(e,t,r)=>{W()[e>>>2>>>0]=t,W()[e+4>>>2>>>0]=r},en=e=>{var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],Ae(t,e)},tn=e=>{var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],t?Ae(t,e):0===e?"":void 0},rn=(e,t)=>{function r(r,n){r=e[r],N()[t+n>>>2>>>0]=r}function n(r,n){x[t+n>>>3]=BigInt(e[r])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),n("maxUniformBufferBindingSize",64),n("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),n("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),void 0!==e.kd&&r("maxImmediateSize",148)},nn={undefined:1,pd:1,gd:2},an={1:"validation",2:"out-of-memory",3:"internal"},on=[,"compatibility","core"],sn={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},un=[,"low-power","high-performance"],ln={1:"occlusion",2:"timestamp"},fn={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function dn(e,t,r,n,i,a){t=be(t),r=be(r),n>>>=0,i>>>=0,a>>>=0,e=Jr(e>>>0);var o={};if(a){var s=W()[a+12>>>2>>>0];if(s){var u=W()[a+16>>>2>>>0];o.requiredFeatures=Array.from(W().subarray(u>>>2>>>0,u+4*s>>>2>>>0),e=>sn[e])}var l=W()[a+20>>>2>>>0];if(l){let e=function(e,t,r=!1){t=l+t,4294967295==(t=W()[t>>>2>>>0])||r&&0==t||(f[e]=t)},t=function(e,t){t=l+t;var r=W()[t>>>2>>>0],n=W()[t+4>>>2>>>0];4294967295==r&&4294967295==n||(f[e]=4294967296*W()[t+4>>>2>>>0]+W()[t>>>2>>>0])};var f={};e("maxTextureDimension1D",4),e("maxTextureDimension2D",8),e("maxTextureDimension3D",12),e("maxTextureArrayLayers",16),e("maxBindGroups",20),e("maxBindGroupsPlusVertexBuffers",24),e("maxDynamicUniformBuffersPerPipelineLayout",32),e("maxDynamicStorageBuffersPerPipelineLayout",36),e("maxSampledTexturesPerShaderStage",40),e("maxSamplersPerShaderStage",44),e("maxStorageBuffersPerShaderStage",48),e("maxStorageTexturesPerShaderStage",52),e("maxUniformBuffersPerShaderStage",56),e("minUniformBufferOffsetAlignment",80),e("minStorageBufferOffsetAlignment",84),t("maxUniformBufferBindingSize",64),t("maxStorageBufferBindingSize",72),e("maxVertexBuffers",88),t("maxBufferSize",96),e("maxVertexAttributes",104),e("maxVertexBufferArrayStride",108),e("maxInterStageShaderVariables",112),e("maxColorAttachments",116),e("maxColorAttachmentBytesPerSample",120),e("maxComputeWorkgroupStorageSize",124),e("maxComputeInvocationsPerWorkgroup",128),e("maxComputeWorkgroupSizeX",132),e("maxComputeWorkgroupSizeY",136),e("maxComputeWorkgroupSizeZ",140),e("maxComputeWorkgroupsPerDimension",144),e("maxImmediateSize",148,!0),o.requiredLimits=f}(s=W()[a+24>>>2>>>0])&&(s={label:tn(s+4)},o.defaultQueue=s),o.label=tn(a+4)}ne+=1,Qr(t,e.requestDevice(o).then(e=>{--ne,Yr(i,e.queue),Yr(n,e),r&&(ne+=1,Qr(r,e.lost.then(t=>{--ne,e.onuncapturederror=()=>{};var n=qi(),i=Hr(t.message);Ui(r,nn[t.reason],i),zi(n)}))),e.onuncapturederror=e=>{var t=5;e.error instanceof GPUValidationError?t=2:e.error instanceof GPUOutOfMemoryError?t=3:e.error instanceof GPUInternalError&&(t=4);var r=qi();e=Hr(e.error.message),Li(n,t,e),zi(r)},ji(t,1,n,0)},e=>{--ne;var i=qi();e=Hr(e.message),ji(t,3,n,e),r&&Ui(r,4,e),zi(i)}))}function pn(e){var t=Jr(e>>>=0),r=Zr[e];if(r){for(var n=0;n<r.length;++n)r[n]();delete Zr[e]}t.destroy()}var cn=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";cn.kc||(cn.kc={}),cn.kc[e]||(cn.kc[e]=1,M(e))};function hn(e,t,r){t>>>=0,r>>>=0;var n=Jr(e>>>=0);0===r&&cn(),4294967295==r&&(r=void 0);try{var i=n.getMappedRange(t,r)}catch{return 0}var a=Fi(16,i.byteLength);return $().set(new Uint8Array(i),a>>>0),Zr[e].push(()=>mi(a)),a}function yn(e,t,r){t>>>=0,r>>>=0;var n=Jr(e>>>=0);0===r&&cn(),4294967295==r&&(r=void 0);try{var i=n.getMappedRange(t,r)}catch{return 0}var a=Fi(16,i.byteLength);return $().fill(0,a,i.byteLength),Zr[e].push(()=>{new Uint8Array(i).set($().subarray(a>>>0,a+i.byteLength>>>0)),mi(a)}),a}function mn(e,t,r,n,i){e>>>=0,t=be(t),r=be(r),i>>>=0;var a=Jr(e);Zr[e]=[],4294967295==i&&(i=void 0),ne+=1,Qr(t,a.mapAsync(r,n>>>0,i).then(()=>{--ne,Bi(t,1,0)},r=>{--ne,qi();var n=Hr(r.message);Bi(t,"AbortError"===r.name?4:"OperationError"===r.name?3:0,n),delete Zr[e]}))}function wn(e){var t=Jr(e>>>=0),r=Zr[e];if(r){for(var n=0;n<r.length;++n)r[n]();delete Zr[e],t.unmap()}}function gn(e){delete qr[e>>>0]}function bn(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=!!W()[t+32>>>2>>>0];t={label:tn(t+4),usage:W()[t+16>>>2>>>0],size:4294967296*W()[t+28>>>2>>>0]+W()[t+24>>>2>>>0],mappedAtCreation:n},e=Jr(e);try{var i=e.createBuffer(t)}catch{return!1}return Yr(r,i),n&&(Zr[r]=[]),!0}function vn(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=W()[t>>>2>>>0],i=W()[n+4>>>2>>>0];t={label:tn(t+4),code:""},2===i&&(t.code=en(n+8)),Yr(r,Jr(e).createShaderModule(t))}var Cn=e=>{Jr(e).destroy()};function Tn(e,t){t=be(t),e=Jr(e>>>0),ne+=1,Qr(t,e.popErrorScope().then(e=>{--ne;var r=5;e?e instanceof GPUValidationError?r=2:e instanceof GPUOutOfMemoryError?r=3:e instanceof GPUInternalError&&(r=4):r=1;var n=qi();e=e?Hr(e.message):0,Ri(t,1,r,e),zi(n)},e=>{--ne;var r=qi();e=Hr(e.message),Ri(t,1,5,e),zi(r)}))}function _n(e,t,r,n){if(t=be(t),n>>>=0,r>>>=0){var i=W()[r+4>>>2>>>0];i={featureLevel:on[i],powerPreference:un[W()[r+8>>>2>>>0]],forceFallbackAdapter:!!W()[r+12>>>2>>>0]},0!==(r=W()[r>>>2>>>0])&&(W(),i.rd=!!W()[r+8>>>2>>>0])}"gpu"in navigator?(ne+=1,Qr(t,navigator.gpu.requestAdapter(i).then(e=>{if(--ne,e)Yr(n,e),Mi(t,1,n,0);else{e=qi();var r=Hr("WebGPU not available on this browser (requestAdapter returned null)");Mi(t,3,n,r),zi(e)}},e=>{--ne;var r=qi();e=Hr(e.message),Mi(t,4,n,e),zi(r)}))):(r=qi(),i=Hr("WebGPU not available on this browser (navigator.gpu is not available)"),Mi(t,3,n,i),zi(r))}function En(e,t,r){return e>>>=0,t>>>=0,r>>>=0,zt(async()=>{var n=[];if(r){var i=N()[r>>>2>>>0];n.length=t+1,n[t]=new Promise(e=>setTimeout(e,i,0))}else n.length=t;for(var a=0;a<t;++a){var o=4294967296*W()[e+8*a+4>>>2>>>0]+W()[e+8*a>>>2>>>0];if(!(o in Xr))return o;n[a]=Xr[o]}return n=await Promise.race(n),delete Xr[n],n})}var An,xn={},On=()=>{if(!An){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in xn)void 0===xn[e]?delete t[e]:t[e]=xn[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);An=r}return An};function In(e,t){if(s)return ie(19,1,e,t);e>>>=0,t>>>=0;var r,n=0,i=0;for(r of On()){var a=t+n;W()[e+i>>>2>>>0]=a,n+=lt(r,a,1/0)+1,i+=4}return 0}function Sn(e,t){if(s)return ie(20,1,e,t);e>>>=0,t>>>=0;var r=On();for(var n of(W()[e>>>2>>>0]=r.length,e=0,r))e+=ft(n)+1;return W()[t>>>2>>>0]=e,0}function Un(e){return s?ie(21,1,e):52}function Bn(e,t,r,n){return s?ie(22,1,e,t,r,n):52}function Rn(e,t,r,n){return s?ie(23,1,e,t,r,n):70}var Mn=[null,[],[]];function jn(e,t,r,n){if(s)return ie(24,1,e,t,r,n);t>>>=0,r>>>=0,n>>>=0;for(var i=0,a=0;a<r;a++){var o=W()[t>>>2>>>0],u=W()[t+4>>>2>>>0];t+=8;for(var l=0;l<u;l++){var f=e,d=$()[o+l>>>0],p=Mn[f];0===d||10===d?((1===f?R:M)(Ee(p)),p.length=0):p.push(d)}i+=u}return W()[n>>>2>>>0]=i,0}function Ln(e,t){return rn(Jr(e>>>0).limits,t>>>0),1}function Pn(e,t){return Jr(e>>>0).features.has(sn[t])}function $n(e){return BigInt(Jr(e>>>0).size)}function kn(e){return BigInt(Jr(e>>>0).usage)}function Dn(e,t){if(e>>>=0,t>>>=0){var r=tn(t+4);r={label:r,timestampWrites:t=0!==(t=W()[t+12>>>2>>>0])?{querySet:Jr(W()[t+4>>>2>>>0]),beginningOfPassWriteIndex:W()[t+8>>>2>>>0],endOfPassWriteIndex:W()[t+12>>>2>>>0]}:void 0}}return e=Jr(e),t=Ei(0),Yr(t,e.beginComputePass(r)),t}function Nn(e,t,r,n,i,a){r=be(r),i=be(i),a=be(a),Jr(e>>>0).copyBufferToBuffer(Jr(t>>>0),r,Jr(n>>>0),i,a)}function Wn(e){e=Jr(e>>>0);var t=Ti(0);return Yr(t,e.finish()),t}function Gn(e,t,r,n,i,a){a=be(a),Jr(e>>>0).resolveQuerySet(Jr(t>>>0),r,n,Jr(i>>>0),a)}function Fn(e,t,r,n){Jr(e>>>0).dispatchWorkgroups(t,r,n)}function Vn(e){Jr(e>>>0).end()}function zn(e,t,r,n,i){n>>>=0,i>>>=0,e=Jr(e>>>0),r=Jr(r>>>0),0==n?e.setBindGroup(t,r):e.setBindGroup(t,r,W(),i>>>2,n)}function Hn(e,t){Jr(e>>>0).setPipeline(Jr(t>>>0))}function qn(e,t,r){Jr(e>>>0).qd(Jr(t>>>0),r)}function Yn(e,t){e=Jr(e>>>0);var r=Ci(0);return Yr(r,e.getBindGroupLayout(t)),r}function Zn(e,t){e>>>=0;var r=tn(4+(t>>>=0)),n=Jr(W()[t+12>>>2>>>0]),i=W()[t+16>>>2>>>0];t=W()[t+20>>>2>>>0];for(var a=[],o=0;o<i;++o){var s=a,u=s.push,l=t+40*o,f=W()[l+8>>>2>>>0],d=W()[l+32>>>2>>>0],p=W()[l+36>>>2>>>0],c=W()[l+4>>>2>>>0];f?(d=l+24,-1==(d=W()[d>>>2>>>0]+4294967296*N()[d+4>>>2>>>0])&&(d=void 0),l={binding:c,resource:{buffer:Jr(f),offset:4294967296*W()[l+4+16>>>2>>>0]+W()[l+16>>>2>>>0],size:d}}):l=d?{binding:c,resource:Jr(d)}:{binding:c,resource:Jr(p)},u.call(s,l)}return r={label:r,layout:n,entries:a},e=Jr(e),n=vi(0),Yr(n,e.createBindGroup(r)),n}function Xn(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:tn(t+4)}),e=Jr(e),t=_i(0),Yr(t,e.createCommandEncoder(r)),t}function Qn(e,t){e>>>=0;var r=t>>>0;t=tn(r+4);var n=(n=W()[r+12>>>2>>>0])?Jr(n):"auto";if(r+=16){var i=Jr(W()[r+4>>>2>>>0]),a=W()[r+16>>>2>>>0],o=W()[r+20>>>2>>>0];if(a){for(var s={},u=0;u<a;++u){var l=o+24*u;s[en(l+4)]=F()[l+16>>>3>>>0]}a=s}else a=void 0;r={module:i,constants:a,entryPoint:tn(r+8)}}else r=void 0;return t={label:t,layout:n,compute:r},e=Jr(e),n=Ai(0),Yr(n,e.createComputePipeline(t)),n}function Jn(e,t){e>>>=0,t>>>=0,t={type:ln[W()[t+12>>>2>>>0]],count:W()[t+16>>>2>>>0]},e=Jr(e);var r=xi(0);return Yr(r,e.createQuerySet(t)),r}function Kn(e,t){e=Jr(e>>>0).adapterInfo,t>>>=0,N()[t+52>>>2>>>0]=e.subgroupMinSize,N()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,n=ft(r)+1,i=wi(n);return i&&lt(r,i,n),r=i,n=ft(e.vendor),Kr(t+4,r,n),r+=n,n=ft(e.architecture),Kr(t+12,r,n),r+=n,n=ft(e.device),Kr(t+20,r,n),Kr(t+28,r+n,ft(e.description)),N()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,N()[t+40>>>2>>>0]=e,N()[t+44>>>2>>>0]=0,N()[t+48>>>2>>>0]=0,1}function ei(e,t){t>>>=0,e=Jr(e>>>0);var r=wi(4*e.features.size),n=0,i=0;e.features.forEach(e=>{void 0!==(e=fn[e])&&(N()[r+n>>>2>>>0]=e,n+=4,i++)}),W()[t+4>>>2>>>0]=r,W()[t>>>2>>>0]=i}function ti(e,t){return rn(Jr(e>>>0).limits,t>>>0),1}function ri(e,t){return Jr(e>>>0).features.has(sn[t])}function ni(e,t){Jr(e>>>0).pushErrorScope(an[t])}function ii(e,t,r){t>>>=0,r>>>=0,e=Jr(e>>>0),t=Array.from(N().subarray(r>>>2>>>0,r+4*t>>>2>>>0),e=>Jr(e)),e.submit(t)}function ai(e,t,r,n,i){r=be(r),n>>>=0,i>>>=0,e=Jr(e>>>0),t=Jr(t>>>0),n=$().subarray(n>>>0,n+i>>>0),e.writeBuffer(t,r,n,0,i)}s||function(){for(var e=n.numThreads-1;e--;)ye();te.push(()=>{var e;Y++,e=()=>X(),s?e():Promise.all(ue.map(he)).then(e)})}();for(var oi=Array(256),si=0;256>si;++si)oi[si]=String.fromCharCode(si);De=oi,Je.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>Je.length/2-5-Qe.length,s||(m=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),z()),n.wasmBinary&&(y=n.wasmBinary),n.stackSave=()=>qi(),n.stackRestore=e=>zi(e),n.stackAlloc=e=>Hi(e),n.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":P()[e>>>0]=t;break;case"i16":k()[e>>>1>>>0]=t;break;case"i32":N()[e>>>2>>>0]=t;break;case"i64":x[e>>>3]=BigInt(t);break;case"float":G()[e>>>2>>>0]=t;break;case"double":F()[e>>>3>>>0]=t;break;case"*":W()[e>>>2>>>0]=t;break;default:Q(`invalid type for setValue: ${r}`)}},n.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return P()[e>>>0];case"i16":return k()[e>>>1>>>0];case"i32":return N()[e>>>2>>>0];case"i64":return x[e>>>3];case"float":return G()[e>>>2>>>0];case"double":return F()[e>>>3>>>0];case"*":return W()[e>>>2>>>0];default:Q(`invalid type for getValue: ${t}`)}},n.UTF8ToString=Ae,n.stringToUTF8=lt,n.lengthBytesUTF8=ft;var ui=[ae,oe,Ce,xe,Oe,Ie,Se,Ue,Be,Re,Me,je,Le,Pe,$e,ke,vr,Cr,Er,In,Sn,Un,Bn,Rn,jn],li={1046876:(e,t,r,i,a)=>{if(void 0===n||!n.fc)return 1;if((e=Ae(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=n.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),i=Number(i>>>0),t+r>e.byteLength)return 3;try{let o=e.subarray(t,t+r);switch(a){case 0:$().set(o,i>>>0);break;case 1:n.Pc?n.Pc(i,o):n.jd(i,o);break;default:return 4}return 0}catch{return 4}},1047700:(e,t,r)=>{n.Rc(e,$().subarray(t>>>0,t+r>>>0))},1047764:()=>n.ed(),1047806:e=>{n.Qc(e)},1047843:()=>typeof wasmOffsetConverter<"u"};function fi(){return typeof wasmOffsetConverter<"u"}var di=await async function(){function e(e,t){return di=e.exports,di=function(){var e=di,t={};for(let[r,n]of Object.entries(e))t[r]="function"==typeof n?(...e)=>{Dt.push(r);try{return n(...e)}finally{j||(Dt.pop(),$t&&1===Pt&&0===Dt.length&&(Pt=0,ne+=1,Lt(Xi),typeof Fibers<"u"&&Fibers.od()))}}:n;return t}(),n=di,i=e=>t=>e(t)>>>0,a=e=>()=>e()>>>0,(n=Object.assign({},n)).ob=i(n.ob),n.Rb=a(n.Rb),n.Tb=i(n.Tb),n.Dc=(r=n.Dc,(e,t)=>r(e,t)>>>0),n.Gc=i(n.Gc),n.Hc=a(n.Hc),n.__cxa_get_exception_ptr=i(n.__cxa_get_exception_ptr),di=n,fe.push(di.vc),w=t,X(),di;var r,n,i,a}Y++;var t=J();if(n.instantiateWasm)return new Promise(r=>{n.instantiateWasm(t,(t,n)=>{r(e(t,n))})});if(s)return new Promise(t=>{S=r=>{var n=new WebAssembly.Instance(r,J());t(e(n,r))}});q??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.asyncify.wasm",h):h+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href;try{var i=await async function(e){var t=q;if(!y&&"function"==typeof WebAssembly.instantiateStreaming&&!L(t))try{var r=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(r,e)}catch(e){M(`wasm streaming compile failed: ${e}`),M("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await async function(e){if(!y)try{var t=await f(e);return new Uint8Array(t)}catch{}if(e==q&&y)e=new Uint8Array(y);else{if(!d)throw"both async and sync fetching of the wasm failed";e=d(e)}return e}(e);return await WebAssembly.instantiate(r,t)}catch(e){M(`failed to asynchronously prepare wasm: ${e}`),Q(e)}}(t,e)}(t);return e(i.instance,i.module)}catch(e){return r(e),Promise.reject(e)}}(),pi=e=>(pi=di.ob)(e),ci=()=>(ci=di.pb)();n._OrtInit=(e,t)=>(n._OrtInit=di.qb)(e,t),n._OrtGetLastError=(e,t)=>(n._OrtGetLastError=di.rb)(e,t),n._OrtCreateSessionOptions=(e,t,r,i,a,o,s,u,l,f)=>(n._OrtCreateSessionOptions=di.sb)(e,t,r,i,a,o,s,u,l,f),n._OrtAppendExecutionProvider=(e,t,r,i,a)=>(n._OrtAppendExecutionProvider=di.tb)(e,t,r,i,a),n._OrtAddFreeDimensionOverride=(e,t,r)=>(n._OrtAddFreeDimensionOverride=di.ub)(e,t,r),n._OrtAddSessionConfigEntry=(e,t,r)=>(n._OrtAddSessionConfigEntry=di.vb)(e,t,r),n._OrtReleaseSessionOptions=e=>(n._OrtReleaseSessionOptions=di.wb)(e),n._OrtCreateSession=(e,t,r)=>(n._OrtCreateSession=di.xb)(e,t,r),n._OrtReleaseSession=e=>(n._OrtReleaseSession=di.yb)(e),n._OrtGetInputOutputCount=(e,t,r)=>(n._OrtGetInputOutputCount=di.zb)(e,t,r),n._OrtGetInputOutputMetadata=(e,t,r,i)=>(n._OrtGetInputOutputMetadata=di.Ab)(e,t,r,i),n._OrtFree=e=>(n._OrtFree=di.Bb)(e),n._OrtCreateTensor=(e,t,r,i,a,o)=>(n._OrtCreateTensor=di.Cb)(e,t,r,i,a,o),n._OrtGetTensorData=(e,t,r,i,a)=>(n._OrtGetTensorData=di.Db)(e,t,r,i,a),n._OrtReleaseTensor=e=>(n._OrtReleaseTensor=di.Eb)(e),n._OrtCreateRunOptions=(e,t,r,i)=>(n._OrtCreateRunOptions=di.Fb)(e,t,r,i),n._OrtAddRunConfigEntry=(e,t,r)=>(n._OrtAddRunConfigEntry=di.Gb)(e,t,r),n._OrtReleaseRunOptions=e=>(n._OrtReleaseRunOptions=di.Hb)(e),n._OrtCreateBinding=e=>(n._OrtCreateBinding=di.Ib)(e),n._OrtBindInput=(e,t,r)=>(n._OrtBindInput=di.Jb)(e,t,r),n._OrtBindOutput=(e,t,r,i)=>(n._OrtBindOutput=di.Kb)(e,t,r,i),n._OrtClearBoundOutputs=e=>(n._OrtClearBoundOutputs=di.Lb)(e),n._OrtReleaseBinding=e=>(n._OrtReleaseBinding=di.Mb)(e),n._OrtRunWithBinding=(e,t,r,i,a)=>(n._OrtRunWithBinding=di.Nb)(e,t,r,i,a),n._OrtRun=(e,t,r,i,a,o,s,u)=>(n._OrtRun=di.Ob)(e,t,r,i,a,o,s,u),n._OrtEndProfiling=e=>(n._OrtEndProfiling=di.Pb)(e);var hi=n._OrtGetWebGpuDevice=e=>(hi=n._OrtGetWebGpuDevice=di.Qb)(e),yi=()=>(yi=di.Rb)(),mi=n._free=e=>(mi=n._free=di.Sb)(e),wi=n._malloc=e=>(wi=n._malloc=di.Tb)(e),gi=n._wgpuBufferRelease=e=>(gi=n._wgpuBufferRelease=di.Ub)(e),bi=n._wgpuCreateInstance=e=>(bi=n._wgpuCreateInstance=di.Vb)(e),vi=e=>(vi=di.Wb)(e),Ci=e=>(Ci=di.Xb)(e),Ti=e=>(Ti=di.Yb)(e),_i=e=>(_i=di.Zb)(e),Ei=e=>(Ei=di._b)(e),Ai=e=>(Ai=di.$b)(e),xi=e=>(xi=di.bc)(e),Oi=(e,t)=>(Oi=di.lc)(e,t),Ii=(e,t)=>(Ii=di.mc)(e,t),Si=e=>(Si=di.nc)(e),Ui=(e,t,r)=>(Ui=di.pc)(e,t,r),Bi=(e,t,r)=>(Bi=di.qc)(e,t,r),Ri=(e,t,r,n)=>(Ri=di.rc)(e,t,r,n),Mi=(e,t,r,n)=>(Mi=di.sc)(e,t,r,n),ji=(e,t,r,n)=>(ji=di.tc)(e,t,r,n),Li=(e,t,r)=>(Li=di.uc)(e,t,r),Pi=(e,t,r,n,i,a)=>(Pi=di.wc)(e,t,r,n,i,a),$i=()=>($i=di.xc)(),ki=(e,t,r,n,i)=>(ki=di.yc)(e,t,r,n,i),Di=e=>(Di=di.zc)(e),Ni=e=>(Ni=di.Ac)(e),Wi=(e,t)=>(Wi=di.Bc)(e,t),Gi=()=>(Gi=di.Cc)(),Fi=(e,t)=>(Fi=di.Dc)(e,t),Vi=(e,t)=>(Vi=di.Ec)(e,t),zi=e=>(zi=di.Fc)(e),Hi=e=>(Hi=di.Gc)(e),qi=()=>(qi=di.Hc)(),Yi=n.dynCall_ii=(e,t)=>(Yi=n.dynCall_ii=di.Ic)(e,t);n.dynCall_viiii=(e,t,r,i,a)=>(n.dynCall_viiii=di.dynCall_viiii)(e,t,r,i,a),n.dynCall_viiiii=(e,t,r,i,a,o)=>(n.dynCall_viiiii=di.dynCall_viiiii)(e,t,r,i,a,o),n.dynCall_viii=(e,t,r,i)=>(n.dynCall_viii=di.Jc)(e,t,r,i),n.dynCall_vi=(e,t)=>(n.dynCall_vi=di.dynCall_vi)(e,t),n.dynCall_viijj=(e,t,r,i,a)=>(n.dynCall_viijj=di.dynCall_viijj)(e,t,r,i,a),n.dynCall_viiiiii=(e,t,r,i,a,o,s)=>(n.dynCall_viiiiii=di.dynCall_viiiiii)(e,t,r,i,a,o,s),n.dynCall_viiiiiiii=(e,t,r,i,a,o,s,u,l)=>(n.dynCall_viiiiiiii=di.dynCall_viiiiiiii)(e,t,r,i,a,o,s,u,l),n.dynCall_i=e=>(n.dynCall_i=di.dynCall_i)(e),n.dynCall_vii=(e,t,r)=>(n.dynCall_vii=di.dynCall_vii)(e,t,r),n.dynCall_fffffff=(e,t,r,i,a,o,s)=>(n.dynCall_fffffff=di.dynCall_fffffff)(e,t,r,i,a,o,s),n.dynCall_iiiii=(e,t,r,i,a)=>(n.dynCall_iiiii=di.dynCall_iiiii)(e,t,r,i,a),n.dynCall_iii=(e,t,r)=>(n.dynCall_iii=di.dynCall_iii)(e,t,r),n.dynCall_iiiiii=(e,t,r,i,a,o)=>(n.dynCall_iiiiii=di.dynCall_iiiiii)(e,t,r,i,a,o),n.dynCall_iiiiiiii=(e,t,r,i,a,o,s,u)=>(n.dynCall_iiiiiiii=di.dynCall_iiiiiiii)(e,t,r,i,a,o,s,u),n.dynCall_iiiiiii=(e,t,r,i,a,o,s)=>(n.dynCall_iiiiiii=di.dynCall_iiiiiii)(e,t,r,i,a,o,s),n.dynCall_iiii=(e,t,r,i)=>(n.dynCall_iiii=di.dynCall_iiii)(e,t,r,i),n.dynCall_vfiii=(e,t,r,i,a)=>(n.dynCall_vfiii=di.dynCall_vfiii)(e,t,r,i,a),n.dynCall_viiiiff=(e,t,r,i,a,o,s)=>(n.dynCall_viiiiff=di.dynCall_viiiiff)(e,t,r,i,a,o,s),n.dynCall_viiiiiff=(e,t,r,i,a,o,s,u)=>(n.dynCall_viiiiiff=di.dynCall_viiiiiff)(e,t,r,i,a,o,s,u),n.dynCall_ffff=(e,t,r,i)=>(n.dynCall_ffff=di.dynCall_ffff)(e,t,r,i),n.dynCall_viiff=(e,t,r,i,a)=>(n.dynCall_viiff=di.dynCall_viiff)(e,t,r,i,a),n.dynCall_jjjjjjj=(e,t,r,i,a,o,s)=>(n.dynCall_jjjjjjj=di.dynCall_jjjjjjj)(e,t,r,i,a,o,s),n.dynCall_jjjjjj=(e,t,r,i,a,o)=>(n.dynCall_jjjjjj=di.dynCall_jjjjjj)(e,t,r,i,a,o),n.dynCall_iijjii=(e,t,r,i,a,o)=>(n.dynCall_iijjii=di.dynCall_iijjii)(e,t,r,i,a,o),n.dynCall_viiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h)=>(n.dynCall_viiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h),n.dynCall_viiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d)=>(n.dynCall_viiiiiiiiii=di.dynCall_viiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d),n.dynCall_viiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p)=>(n.dynCall_viiiiiiiiiii=di.dynCall_viiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p),n.dynCall_viiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c)=>(n.dynCall_viiiiiiiiiiii=di.dynCall_viiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c),n.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b)=>(n.dynCall_viiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b),n.dynCall_viiiiiiiii=(e,t,r,i,a,o,s,u,l,f)=>(n.dynCall_viiiiiiiii=di.dynCall_viiiiiiiii)(e,t,r,i,a,o,s,u,l,f),n.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b,v)=>(n.dynCall_viiiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b,v),n.dynCall_viiiiiii=(e,t,r,i,a,o,s,u)=>(n.dynCall_viiiiiii=di.dynCall_viiiiiii)(e,t,r,i,a,o,s,u),n.dynCall_viiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m)=>(n.dynCall_viiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m),n.dynCall_jiji=(e,t,r,i)=>(n.dynCall_jiji=di.dynCall_jiji)(e,t,r,i),n.dynCall_v=e=>(n.dynCall_v=di.dynCall_v)(e),n.dynCall_iidiiii=(e,t,r,i,a,o,s)=>(n.dynCall_iidiiii=di.dynCall_iidiiii)(e,t,r,i,a,o,s),n.dynCall_ji=(e,t)=>(n.dynCall_ji=di.dynCall_ji)(e,t),n.dynCall_vij=(e,t,r)=>(n.dynCall_vij=di.dynCall_vij)(e,t,r),n.dynCall_viiijii=(e,t,r,i,a,o,s)=>(n.dynCall_viiijii=di.dynCall_viiijii)(e,t,r,i,a,o,s),n.dynCall_viijiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g)=>(n.dynCall_viijiiiiiiiiiiiiii=di.dynCall_viijiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g),n.dynCall_viiiji=(e,t,r,i,a,o)=>(n.dynCall_viiiji=di.dynCall_viiiji)(e,t,r,i,a,o),n.dynCall_jfi=(e,t,r)=>(n.dynCall_jfi=di.dynCall_jfi)(e,t,r),n.dynCall_fif=(e,t,r)=>(n.dynCall_fif=di.dynCall_fif)(e,t,r),n.dynCall_jii=(e,t,r)=>(n.dynCall_jii=di.dynCall_jii)(e,t,r),n.dynCall_viiiijii=(e,t,r,i,a,o,s,u)=>(n.dynCall_viiiijii=di.dynCall_viiiijii)(e,t,r,i,a,o,s,u),n.dynCall_iij=(e,t,r)=>(n.dynCall_iij=di.dynCall_iij)(e,t,r),n.dynCall_viji=(e,t,r,i)=>(n.dynCall_viji=di.dynCall_viji)(e,t,r,i),n.dynCall_iiiiiiiii=(e,t,r,i,a,o,s,u,l)=>(n.dynCall_iiiiiiiii=di.dynCall_iiiiiiiii)(e,t,r,i,a,o,s,u,l),n.dynCall_iiij=(e,t,r,i)=>(n.dynCall_iiij=di.dynCall_iiij)(e,t,r,i),n.dynCall_iiiiiiiiii=(e,t,r,i,a,o,s,u,l,f)=>(n.dynCall_iiiiiiiiii=di.dynCall_iiiiiiiiii)(e,t,r,i,a,o,s,u,l,f),n.dynCall_iiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c)=>(n.dynCall_iiiiiiiiiiiii=di.dynCall_iiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c),n.dynCall_iiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d)=>(n.dynCall_iiiiiiiiiii=di.dynCall_iiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d),n.dynCall_iijii=(e,t,r,i,a)=>(n.dynCall_iijii=di.dynCall_iijii)(e,t,r,i,a),n.dynCall_fiii=(e,t,r,i)=>(n.dynCall_fiii=di.dynCall_fiii)(e,t,r,i),n.dynCall_viijii=(e,t,r,i,a,o)=>(n.dynCall_viijii=di.dynCall_viijii)(e,t,r,i,a,o),n.dynCall_viij=(e,t,r,i)=>(n.dynCall_viij=di.dynCall_viij)(e,t,r,i),n.dynCall_jiij=(e,t,r,i)=>(n.dynCall_jiij=di.dynCall_jiij)(e,t,r,i),n.dynCall_fi=(e,t)=>(n.dynCall_fi=di.dynCall_fi)(e,t),n.dynCall_fii=(e,t,r)=>(n.dynCall_fii=di.dynCall_fii)(e,t,r),n.dynCall_dii=(e,t,r)=>(n.dynCall_dii=di.dynCall_dii)(e,t,r),n.dynCall_fiiii=(e,t,r,i,a)=>(n.dynCall_fiiii=di.dynCall_fiiii)(e,t,r,i,a),n.dynCall_viiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y)=>(n.dynCall_viiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y),n.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b,v,C)=>(n.dynCall_viiiiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w,g,b,v,C),n.dynCall_viiiiiiiiiiiiiiii=(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w)=>(n.dynCall_viiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiii)(e,t,r,i,a,o,s,u,l,f,d,p,c,h,y,m,w),n.dynCall_iif=(e,t,r)=>(n.dynCall_iif=di.dynCall_iif)(e,t,r),n.dynCall_jiiii=(e,t,r,i,a)=>(n.dynCall_jiiii=di.dynCall_jiiii)(e,t,r,i,a),n.dynCall_jiii=(e,t,r,i)=>(n.dynCall_jiii=di.dynCall_jiii)(e,t,r,i),n.dynCall_viif=(e,t,r,i)=>(n.dynCall_viif=di.dynCall_viif)(e,t,r,i),n.dynCall_viiij=(e,t,r,i,a)=>(n.dynCall_viiij=di.dynCall_viiij)(e,t,r,i,a),n.dynCall_iiiiij=(e,t,r,i,a,o)=>(n.dynCall_iiiiij=di.dynCall_iiiiij)(e,t,r,i,a,o),n.dynCall_iiiiid=(e,t,r,i,a,o)=>(n.dynCall_iiiiid=di.dynCall_iiiiid)(e,t,r,i,a,o),n.dynCall_iiiiijj=(e,t,r,i,a,o,s)=>(n.dynCall_iiiiijj=di.dynCall_iiiiijj)(e,t,r,i,a,o,s),n.dynCall_iiiiiijj=(e,t,r,i,a,o,s,u)=>(n.dynCall_iiiiiijj=di.dynCall_iiiiiijj)(e,t,r,i,a,o,s,u);var Zi=e=>(Zi=di.Kc)(e),Xi=()=>(Xi=di.Lc)(),Qi=e=>(Qi=di.Mc)(e),Ji=()=>(Ji=di.Nc)();return function e(){if(0<Y)Z=e;else if(s)t(n),H();else{for(;0<te.length;)te.shift()(n);0<Y?Z=e:(n.calledRun=!0,j||(H(),t(n)))}}(),n.PTR_SIZE=4,n.webgpuInit=e=>{let t,r,i=new WeakMap,a=1;n.webgpuRegisterDevice=e=>{if(void 0!==r)throw Error("another WebGPU EP inference session is being created.");if(e){var n=i.get(e);if(!n){let t=((e,t=0)=>{var r=Si(t);return t=Ii(t,r),Yr(r,e.queue),Yr(t,e),t})(e,n=bi(0));n=[a++,n,t],i.set(e,n)}return t=e,r=n[0],n}t=void 0,r=0};let o=new Map;n.webgpuOnCreateSession=n=>{if(void 0!==r){var i=r;if(r=void 0,n){let r=hi(i);o.set(n,r),0===i&&e(t??Jr(r))}t=void 0}},n.webgpuOnReleaseSession=e=>{o.delete(e)};let s=Symbol("gpuBufferMetadata");n.webgpuRegisterBuffer=(e,t,r)=>{if(r)return e[s]=[r,NaN],r;if(r=e[s])return r[1]++,r[0];if(void 0===(t=o.get(t)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");return t=((e,t=0)=>("pending"!=e.mapState||Q(),t=Oi(t,"mapped"==e.mapState?3:1),Yr(t,e),"mapped"==e.mapState&&(Zr[t]=[]),t))(e,t),e[s]=[t,1],t},n.webgpuUnregisterBuffer=e=>{let t=e[s];if(!t)throw Error("Buffer is not registered");t[1]--,0===t[1]&&(gi(t[0]),delete e[s])},n.webgpuGetBuffer=e=>Jr(e),n.webgpuCreateDownloader=(e,t,r)=>{if(void 0===(r=o.get(r)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");let n=Jr(r),i=16*Math.ceil(Number(t)/16);return async()=>{let r=n.createBuffer({size:i,usage:9});try{let a=n.createCommandEncoder();return a.copyBufferToBuffer(e,0,r,0,i),n.queue.submit([a.finish()]),await r.mapAsync(GPUMapMode.READ),r.getMappedRange().slice(0,t)}finally{r.destroy()}}},n.Pc=(e,n)=>{var i=n.buffer;let a=n.byteOffset,o=n.byteLength;if(n=16*Math.ceil(Number(o)/16),e=Jr(e),!t){var s=hi(r);t=Jr(s)}let u=(s=t.createBuffer({mappedAtCreation:!0,size:n,usage:6})).getMappedRange();new Uint8Array(u).set(new Uint8Array(i,a,o)),s.unmap(),(i=t.createCommandEncoder()).copyBufferToBuffer(s,0,e,0,n),t.queue.submit([i.finish()]),s.destroy()}},n.webnnInit=e=>{let t=e[0];[n.ed,n.Qc,n.webnnEnsureTensor,n.Rc,n.webnnDownloadTensor,n.dd,n.webnnEnableTraceEvent]=e.slice(1),n.webnnReleaseTensorId=n.Qc,n.webnnUploadTensor=n.Rc,n.webnnRegisterMLContext=n.dd,n.webnnOnRunStart=e=>t.onRunStart(e),n.webnnOnRunEnd=t.onRunEnd.bind(t),n.webnnOnReleaseSession=e=>{t.onReleaseSession(e)},n.webnnCreateMLTensorDownloader=(e,r)=>t.createMLTensorDownloader(e,r),n.webnnRegisterMLTensor=(e,r,n,i)=>t.registerMLTensor(e,r,n,i),n.webnnCreateMLContext=e=>t.createMLContext(e),n.webnnRegisterMLConstant=(e,r,i,a,o,s)=>t.registerMLConstant(e,r,i,a,o,n.fc,s),n.webnnRegisterGraphInput=t.registerGraphInput.bind(t),n.webnnIsGraphInput=t.isGraphInput.bind(t),n.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),n.webnnIsGraphOutput=t.isGraphOutput.bind(t),n.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),n.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},i},me=ye,we=globalThis.self?.name?.startsWith("em-pthread"),we&&ye()}),Ot=D(()=>{ue(),ge=typeof location>"u"?void 0:location.origin,be=import.meta.url>"file:"&&import.meta.url<"file;",ve=()=>{if(be){let e=URL;return new URL(new e("ort.webgpu.bundle.min.mjs",import.meta.url).href,ge).href}return import.meta.url},Ce=ve(),Te=()=>{if(Ce&&!Ce.startsWith("blob:"))return Ce.substring(0,Ce.lastIndexOf("/")+1)},_e=(e,t)=>{try{let r=t??Ce;return(r?new URL(e,r):new URL(e)).origin===ge}catch{return!1}},Ee=(e,t)=>{let r=t??Ce;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},Ae=(e,t)=>`${t??"./"}${e}`,xe=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},Oe=async e=>(await import(e)).default,Ie=(ce(),W(le)).default,Se=async()=>{if(!Ce)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(_e(Ce))return[void 0,Ie()];let e=await xe(Ce);return[e,Ie(e)]},Ue=(xt(),W(he)).default,Be=async(e,t,r,n)=>{let i=Ue&&!(e||t);if(i)if(Ce)i=_e(Ce);else{if(!n||r)throw new Error("cannot determine the script source URL.");i=!0}if(i)return[void 0,Ue];{let n="ort-wasm-simd-threaded.asyncify.mjs",i=e??Ee(n,t),a=r&&i&&!_e(i,t),o=a?await xe(i):i??Ae(n,t);return[a?o:void 0,await Oe(o)]}}}),It=D(()=>{Ot(),Me=!1,je=!1,Le=!1,Pe=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},$e=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ke=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},De=async e=>{if(Me)return Promise.resolve();if(je)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Le)throw new Error("previous call to 'initializeWebAssembly()' failed.");je=!0;let t=e.initTimeout,r=e.numThreads;if(!1!==e.simd)if("relaxed"===e.simd){if(!ke())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!$e())throw new Error("WebAssembly SIMD is not supported in the current environment.");let n=Pe();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let i=e.wasmPaths,a="string"==typeof i?i:void 0,o=i?.mjs,s=o?.href??o,u=i?.wasm,l=u?.href??u,f=e.wasmBinary,[d,p]=await Be(s,a,r>1,!!f||!!l),c=!1,h=[];if(t>0&&h.push(new Promise(e=>{setTimeout(()=>{c=!0,e()},t)})),h.push(new Promise((e,t)=>{let n={numThreads:r};if(f)n.wasmBinary=f;else if(l||a)n.locateFile=e=>l??a+e;else if(s&&0!==s.indexOf("blob:"))n.locateFile=e=>new URL(e,s).href;else if(d){let e=Te();e&&(n.locateFile=t=>e+t)}p(n).then(t=>{je=!1,Me=!0,Re=t,e(),d&&URL.revokeObjectURL(d)},e=>{je=!1,Le=!0,t(e)})})),await Promise.race(h),c)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},Ne=()=>{if(Me&&Re)return Re;throw new Error("WebAssembly is not initialized yet.")}}),St=D(()=>{It(),We=(e,t)=>{let r=Ne(),n=r.lengthBytesUTF8(e)+1,i=r._malloc(n);return r.stringToUTF8(e,i,n),t.push(i),i},Ge=(e,t,r,n)=>{if("object"==typeof e&&null!==e){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([e,i])=>{let a=t?t+e:e;if("object"==typeof i)Ge(i,a+".",r,n);else if("string"==typeof i||"number"==typeof i)n(a,i.toString());else{if("boolean"!=typeof i)throw new Error("Can't handle extra config type: "+typeof i);n(a,i?"1":"0")}})},Fe=e=>{let t=Ne(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);t._OrtGetLastError(n,n+r);let i=Number(t.getValue(n,4===r?"i32":"i64")),a=t.getValue(n+r,"*"),o=a?t.UTF8ToString(a):"";throw new Error(`${e} ERROR_CODE: ${i}, ERROR_MESSAGE: ${o}`)}finally{t.stackRestore(r)}}}),Ut=D(()=>{It(),St(),Ve=e=>{let t=Ne(),r=0,n=[],i=e||{};try{if(void 0===e?.logSeverityLevel)i.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${e.logSeverityLevel}`);if(void 0===e?.logVerbosityLevel)i.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);void 0===e?.terminate&&(i.terminate=!1);let a=0;return void 0!==e?.tag&&(a=We(e.tag,n)),r=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,a),0===r&&Fe("Can't create run options."),void 0!==e?.extra&&Ge(e.extra,"",new WeakSet,(e,i)=>{let a=We(e,n),o=We(i,n);0!==t._OrtAddRunConfigEntry(r,a,o)&&Fe(`Can't set a run config entry: ${e} - ${i}.`)}),[r,n]}catch(e){throw 0!==r&&t._OrtReleaseRunOptions(r),n.forEach(e=>t._free(e)),e}}}),Bt=D(()=>{It(),St(),ze=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},He=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},qe=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(e=>"webgpu"===("string"==typeof e?e:e.name))&&(e.enableMemPattern=!1)},Ye=(e,t,r,n)=>{let i=We(t,n),a=We(r,n);0!==Ne()._OrtAddSessionConfigEntry(e,i,a)&&Fe(`Can't set a session config entry: ${t} - ${r}.`)},Ze=(e,t,r,n)=>{let i=We(t,n),a=We(r,n);e.push([i,a])},Xe=async(e,t,r)=>{for(let n of t){let t="string"==typeof n?n:n.name,i=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof n){let t=n?.deviceType;t&&Ye(e,"deviceType",t,r)}break;case"webgpu":{let e;if(t="WebGPU","string"!=typeof n){let t=n;if(t.device){if(!(typeof GPUDevice<"u"&&t.device instanceof GPUDevice))throw new Error("Invalid GPU device set in WebGPU EP options.");e=t.device}}let a=Ne().webgpuRegisterDevice(e);if(a){let[e,t,n]=a;Ze(i,"deviceId",e.toString(),r),Ze(i,"webgpuInstance",t.toString(),r),Ze(i,"webgpuDevice",n.toString(),r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${t}`)}let a=We(t,r),o=i.length,s=0,u=0;if(o>0){s=Ne()._malloc(o*Ne().PTR_SIZE),r.push(s),u=Ne()._malloc(o*Ne().PTR_SIZE),r.push(u);for(let e=0;e<o;e++)Ne().setValue(s+e*Ne().PTR_SIZE,i[e][0],"*"),Ne().setValue(u+e*Ne().PTR_SIZE,i[e][1],"*")}0!==await Ne()._OrtAppendExecutionProvider(e,a,s,u,o)&&Fe(`Can't append execution provider: ${t}.`)}},Qe=async e=>{let t=Ne(),r=0,n=[],i=e||{};qe(i);try{let e=ze(i.graphOptimizationLevel??"all"),a=He(i.executionMode??"sequential"),o="string"==typeof i.logId?We(i.logId,n):0,s=i.logSeverityLevel??2;if(!Number.isInteger(s)||s<0||s>4)throw new Error(`log severity level is not valid: ${s}`);let u=i.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let l="string"==typeof i.optimizedModelFilePath?We(i.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(e,!!i.enableCpuMemArena,!!i.enableMemPattern,a,!!i.enableProfiling,0,o,s,u,l),0===r&&Fe("Can't create session options."),i.executionProviders&&await Xe(r,i.executionProviders,n),void 0!==i.enableGraphCapture){if("boolean"!=typeof i.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Ye(r,"enableGraphCapture",i.enableGraphCapture.toString(),n)}if(i.freeDimensionOverrides)for(let[e,a]of Object.entries(i.freeDimensionOverrides)){if("string"!=typeof e)throw new Error(`free dimension override name must be a string: ${e}`);if("number"!=typeof a||!Number.isInteger(a)||a<0)throw new Error(`free dimension override value must be a non-negative integer: ${a}`);let i=We(e,n);0!==t._OrtAddFreeDimensionOverride(r,i,a)&&Fe(`Can't set a free dimension override: ${e} - ${a}.`)}return void 0!==i.extra&&Ge(i.extra,"",new WeakSet,(e,t)=>{Ye(r,e,t,n)}),[r,n]}catch(e){throw 0!==r&&0!==t._OrtReleaseSessionOptions(r)&&Fe("Can't release session options."),n.forEach(e=>t._free(e)),e}}}),Rt=D(()=>{Je=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Ke=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},et=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return r>0?Math.ceil(n*r):void 0},tt=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},rt=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},nt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,it=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,at=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),Mt=D(()=>{ue(),ot=async e=>{if("string"==typeof e){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let r,i=t.body.getReader();try{r=new ArrayBuffer(n)}catch(e){if(!(e instanceof RangeError))throw e;{let e=Math.ceil(n/65536);r=new WebAssembly.Memory({initial:e,maximum:e}).buffer}}let a=0;for(;;){let{done:e,value:t}=await i.read();if(e)break;let n=t.byteLength;new Uint8Array(r,a,n).set(t),a+=n}return new Uint8Array(r,0,n)}}return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),jt=D(()=>{Rt(),st=(e,t)=>new(tt(t))(e)}),Lt=D(()=>{Rt(),ut=["V","I","W","E","F"],lt=(e,t)=>{console.log(`[${ut[e]},${(new Date).toISOString()}]${t}`)},pt=(e,t)=>{ft=e,dt=t},ct=(e,t)=>{let r=rt(e);r>=rt(ft)&&lt(r,"function"==typeof t?t():t)},ht=(...e)=>{dt&&ct(...e)}}),Pt=D(()=>{Rt(),Lt(),yt=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),mt=(e,t)=>{if("int32"===t)return e;let r=yt.get(t);if(!r)throw new Error(`WebNN backend does not support data type: ${t}`);let n=r/8;if(e.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let i=e.byteLength/n,a=new(tt(t))(e.buffer,e.byteOffset,i);switch(t){case"int64":case"uint64":{let e=new Int32Array(i);for(let t=0;t<i;t++){let r=a[t];if(r>2147483647n||r<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");e[t]=Number(r)}return new Uint8Array(e.buffer)}case"int8":case"uint8":case"uint32":{if("uint32"===t&&a.some(e=>e>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let e=Int32Array.from(a,Number);return new Uint8Array(e.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},wt=(e,t)=>{if("int32"===t)return e;if(e.byteLength%4!=0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let r=e.byteLength/4,n=new Int32Array(e.buffer,e.byteOffset,r);switch(t){case"int64":{let e=BigInt64Array.from(n,BigInt);return new Uint8Array(e.buffer)}case"uint64":{if(n.some(e=>e<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let e=BigUint64Array.from(n,BigInt);return new Uint8Array(e.buffer)}case"int8":{if(n.some(e=>e<-128||e>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let e=Int8Array.from(n,Number);return new Uint8Array(e.buffer)}case"uint8":if(n.some(e=>e<0||e>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number);case"uint32":{if(n.some(e=>e<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let e=Uint32Array.from(n,Number);return new Uint8Array(e.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},gt=1,bt=()=>gt++,vt=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ct=(e,t)=>{let r=yt.get(e);if(!r)throw new Error(`WebNN backend does not support data type: ${e}`);return t.length>0?Math.ceil(t.reduce((e,t)=>e*t)*r/8):0},Tt=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:r,tensor:n,dataType:i,shape:a,fallbackDataType:o}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=n,this.dataType=i,this.tensorShape=a,this.fallbackDataType=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ct(this.dataType,this.tensorShape)}destroy(){ht("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),r=wt(new Uint8Array(t),this.dataType);return e?void(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(r):r.buffer}return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((e,t)=>e===r[t])}setIsDataConverted(e){this.isDataConverted=e}},_t=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,n){let i,a=this.tensorManager.getMLContext(e);if(!a.opSupportLimits().input.dataTypes.includes(t)){if(i=vt.get(t),!i||!a.opSupportLimits().input.dataTypes.includes(i))throw new Error(`WebNN backend does not support data type: ${t}`);ht("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${t} to ${i}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(a,t,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Ct(t,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,r,o,!0,!0,i),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType){if("int32"!==this.wrapper.fallbackType)throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);t=mt(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0)}if(e.byteLength===this.wrapper.byteLength)return void this.wrapper.write(t);ht("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){let t=this.wrapper?.isDataConverted?wt(this.activeUpload,this.wrapper?.type):this.activeUpload;return e?void(e instanceof ArrayBuffer?new Uint8Array(e).set(t):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(t)):t.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},Et=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=bt();return this.tensorTrackersById.set(e,new _t(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,n,i){ht("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${n}, copyOld: ${i}}`);let a=this.tensorTrackersById.get(t);if(!a)throw new Error("Tensor not found.");return a.ensureTensor(e,r,n,i)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");r.upload(t)}async download(e,t){ht("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,n){let i=this.getMLContext(e),a=bt(),o=new Tt({sessionId:e,context:i,tensor:t,dataType:r,shape:n});return this.tensorTrackersById.set(a,new _t(this,o)),this.externalTensors.add(o),a}async getCachedTensor(e,t,r,n,i,a,o){let s=this.getMLContext(e);for(let[n,i]of this.freeTensors.entries())if(i.canReuseTensor(s,t,r)){ht("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}`);let i=this.freeTensors.splice(n,1)[0];return i.sessionId=e,i}ht("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}}`);let u=await s.createTensor({dataType:o??t,shape:r,dimensions:r,usage:n,writable:i,readable:a});return new Tt({sessionId:e,context:s,tensor:u,dataType:t,shape:r,fallbackDataType:o})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},At=(...e)=>new Et(...e)}),$t={};N($t,{WebNNBackend:()=>Nt});var kt,Dt,Nt,Wt,Gt,Ft,Vt,zt,Ht,qt,Yt,Zt,Xt,Qt,Jt,Kt,er,tr,rr,nr,ir,ar,or,sr,ur,lr,fr,dr,pr,cr,hr,yr,mr,wr,gr,br,vr,Cr=D(()=>{Rt(),It(),jt(),Pt(),Lt(),kt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Dt=(e,t)=>{if(e===t)return!0;if(void 0===e||void 0===t)return!1;let r=Object.keys(e).sort(),n=Object.keys(t).sort();return r.length===n.length&&r.every((r,i)=>r===n[i]&&e[r]===t[r])},Nt=class{constructor(e){this.tensorManager=At(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,pt(e.logLevel,!!e.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw new Error("No active session");return this.activeSessionId}onRunStart(e){ht("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){ht("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let e of t)ht("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(t=>t.gpuDevice===e);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:t}),t}}if(void 0===e){let e=this.mlContextCache.findIndex(e=>void 0===e.options&&void 0===e.gpuDevice);if(-1!==e)return this.mlContextCache[e].mlContext;{let e=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:e}),e}}let t=this.mlContextCache.findIndex(t=>Dt(t.options,e));if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),0===r.size){this.sessionIdsByMLContext.delete(t);let e=this.mlContextCache.findIndex(e=>e.mlContext===t);-1!==e&&this.mlContextCache.splice(e,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){ht("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,n,i){let a=kt.get(r);if(!a)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,a,n,i)}async createTemporaryTensor(e,t,r){ht("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let n=kt.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,n,r,!1);let a=this.temporarySessionTensorIds.get(e);return a?a.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,t){if(!Ne().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ht("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return st(r,t)}}registerMLTensor(e,t,r,n){let i=kt.get(r);if(!i)throw new Error(`Unsupported ONNX data type: ${r}`);let a=this.tensorManager.registerTensor(e,t,i,n);return ht("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${i}, dimensions: ${n}} -> {tensorId: ${a}}`),a}registerMLConstant(e,t,r,n,i,a,o=!1){if(!a)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let u=a.get(s);if(!u)throw new Error(`File with name ${s} not found in preloaded files.`);if(t+r>u.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let l,f=u.slice(t,t+r).buffer;switch(i.dataType){case"float32":l=new Float32Array(f);break;case"float16":l=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":l=new Int32Array(f);break;case"uint32":l=new Uint32Array(f);break;case"int64":if(o){let e=mt(new Uint8Array(f),"int64");l=new Int32Array(e.buffer),i.dataType="int32"}else l=new BigInt64Array(f);break;case"uint64":l=new BigUint64Array(f);break;case"int8":l=new Int8Array(f);break;case"int4":case"uint4":case"uint8":l=new Uint8Array(f);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return ht("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${o?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(i,l)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return!!r&&r.includes(t)}isGraphOutput(e,t){let r=this.sessionGraphOutputs.get(e);return!!r&&r.includes(t)}isGraphInputOutputTypeSupported(e,t,r=!0){let n=this.mlContextBySessionId.get(e),i=kt.get(Je(t));return!(typeof i>"u"||(r?!n?.opSupportLimits().input.dataTypes.includes(i):!n?.opSupportLimits().output.dataTypes.includes(i)))}flush(){}}}),Tr=D(()=>{se(),Ut(),Bt(),Rt(),It(),St(),Mt(),Wt=(e,t)=>{0!==Ne()._OrtInit(e,t)&&Fe("Can't initialize onnxruntime.")},Gt=async e=>{Wt(e.wasm.numThreads,rt(e.logLevel))},Ft=async(e,t)=>{Ne().asyncInit?.();let r=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(r){if("object"!=typeof r.limits||"object"!=typeof r.features||"function"!=typeof r.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw new Error(`Invalid powerPreference setting: "${t}"`);let n=e.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw new Error(`Invalid forceFallbackAdapter setting: "${n}"`);if(r=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:n}),!r)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if("webgpu"===t&&Ne().webgpuInit(t=>{e.webgpu.device=t}),"webnn"===t){let t=new((Cr(),W($t)).WebNNBackend)(e);Ne().webnnInit([t,()=>t.reserveTensorId(),e=>t.releaseTensorId(e),async(e,r,n,i,a)=>t.ensureTensor(e,r,n,i,a),(e,r)=>{t.uploadTensor(e,r)},async(e,r)=>t.downloadTensor(e,r),(e,r)=>t.registerMLContext(e,r),!!e.trace])}},Vt=new Map,zt=e=>{let t=Ne(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);0!==t._OrtGetInputOutputCount(e,n,n+r)&&Fe("Can't get session input/output count.");let i=4===r?"i32":"i64";return[Number(t.getValue(n,i)),Number(t.getValue(n+r,i))]}finally{t.stackRestore(r)}},Ht=(e,t)=>{let r=Ne(),n=r.stackSave(),i=0;try{let n=r.PTR_SIZE,a=r.stackAlloc(2*n);0!==r._OrtGetInputOutputMetadata(e,t,a,a+n)&&Fe("Can't get session input/output metadata.");let o=Number(r.getValue(a,"*"));i=Number(r.getValue(a+n,"*"));let s=r.HEAP32[i/4];if(0===s)return[o,0];let u=r.HEAPU32[i/4+1],l=[];for(let e=0;e<u;e++){let t=Number(r.getValue(i+8+e*n,"*"));l.push(0!==t?r.UTF8ToString(t):Number(r.getValue(i+8+(e+u)*n,"*")))}return[o,s,l]}finally{r.stackRestore(n),0!==i&&r._OrtFree(i)}},qt=e=>{let t=Ne(),r=t._malloc(e.byteLength);if(0===r)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},Yt=async(e,t)=>{let r,n,i=Ne();Array.isArray(e)?[r,n]=e:e.buffer===i.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=qt(e);let a=0,o=0,s=0,u=[],l=[],f=[];try{if([o,u]=await Qe(t),t?.externalData&&i.mountExternalData){let e=[];for(let r of t.externalData){let t="string"==typeof r?r:r.path;e.push(ot("string"==typeof r?r:r.data).then(e=>{i.mountExternalData(t,e)}))}await Promise.all(e)}for(let e of t?.executionProviders??[])if("webnn"===("string"==typeof e?e:e.name)){if(i.shouldTransferToMLTensor=!1,"string"!=typeof e){let t=e,r=t?.context,n=t?.gpuDevice,a=t?.deviceType,o=t?.powerPreference;i.currentContext=r||(n?await i.webnnCreateMLContext(n):await i.webnnCreateMLContext({deviceType:a,powerPreference:o}))}else i.currentContext=await i.webnnCreateMLContext();break}a=await i._OrtCreateSession(r,n,o),i.webgpuOnCreateSession?.(a),0===a&&Fe("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(a,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[e,d]=zt(a),p=!!t?.enableGraphCapture,c=[],h=[],y=[],m=[],w=[];for(let t=0;t<e;t++){let[e,r,n]=Ht(a,t);0===e&&Fe("Can't get an input name."),l.push(e);let o=i.UTF8ToString(e);c.push(o),y.push(0===r?{name:o,isTensor:!1}:{name:o,isTensor:!0,type:Ke(r),shape:n})}for(let r=0;r<d;r++){let[n,o,s]=Ht(a,r+e);0===n&&Fe("Can't get an output name."),f.push(n);let u=i.UTF8ToString(n);h.push(u),m.push(0===o?{name:u,isTensor:!1}:{name:u,isTensor:!0,type:Ke(o),shape:s});{if(p&&void 0===t?.preferredOutputLocation){w.push("gpu-buffer");continue}let e="string"==typeof t?.preferredOutputLocation?t.preferredOutputLocation:t?.preferredOutputLocation?.[u]??"cpu",r=i.webnnIsGraphOutput;if("cpu"===e&&r&&r(a,u)){w.push("ml-tensor-cpu-output");continue}if("cpu"!==e&&"cpu-pinned"!==e&&"gpu-buffer"!==e&&"ml-tensor"!==e)throw new Error(`Not supported preferred output location: ${e}.`);if(p&&"gpu-buffer"!==e)throw new Error(`Not supported preferred output location: ${e}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);w.push(e)}}let g=null;return w.some(e=>"gpu-buffer"===e||"ml-tensor"===e||"ml-tensor-cpu-output"===e)&&(s=i._OrtCreateBinding(a),0===s&&Fe("Can't create IO binding."),g={handle:s,outputPreferredLocations:w,outputPreferredLocationsEncoded:w.map(e=>"ml-tensor-cpu-output"===e?"ml-tensor":e).map(e=>at(e))}),Vt.set(a,[a,l,f,g,p,!1]),[a,c,h,y,m]}catch(e){throw l.forEach(e=>i._OrtFree(e)),f.forEach(e=>i._OrtFree(e)),0!==s&&0!==i._OrtReleaseBinding(s)&&Fe("Can't release IO binding."),0!==a&&0!==i._OrtReleaseSession(a)&&Fe("Can't release session."),e}finally{i._free(r),0!==o&&0!==i._OrtReleaseSessionOptions(o)&&Fe("Can't release session options."),u.forEach(e=>i._free(e)),i.unmountExternalData?.()}},Zt=e=>{let t=Ne(),r=Vt.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,i,a,o,s]=r;o&&(s&&0!==t._OrtClearBoundOutputs(o.handle)&&Fe("Can't clear bound outputs."),0!==t._OrtReleaseBinding(o.handle)&&Fe("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),t.webnnOnReleaseSession?.(e),t.webgpuOnReleaseSession?.(e),i.forEach(e=>t._OrtFree(e)),a.forEach(e=>t._OrtFree(e)),0!==t._OrtReleaseSession(n)&&Fe("Can't release session."),Vt.delete(e)},Xt=async(e,t,r,n,i,a,o=!1)=>{if(!e)return void t.push(0);let s,u,l=Ne(),f=l.PTR_SIZE,d=e[0],p=e[1],c=e[3],h=c;if("string"===d&&("gpu-buffer"===c||"ml-tensor"===c))throw new Error("String tensor is not supported on GPU.");if(o&&"gpu-buffer"!==c)throw new Error(`External buffer must be provided for input/output index ${a} when enableGraphCapture is true.`);if("gpu-buffer"===c){let t=e[2].gpuBuffer;u=et(Je(d),p);{let e=l.webgpuRegisterBuffer;if(!e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=e(t,n)}}else if("ml-tensor"===c){let t=e[2].mlTensor;u=et(Je(d),p);let r=l.webnnRegisterMLTensor;if(!r)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');s=r(n,t,Je(d),p)}else{let t=e[2];if(Array.isArray(t)){u=f*t.length,s=l._malloc(u),r.push(s);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw new TypeError(`tensor data at index ${e} is not a string`);l.setValue(s+e*f,We(t[e],r),"*")}}else{let e=l.webnnIsGraphInput,a=l.webnnIsGraphOutput;if("string"!==d&&e&&a){let o=l.UTF8ToString(i);if(e(n,o)||a(n,o)){let e=Je(d);u=et(e,p),h="ml-tensor";let r=l.webnnCreateTemporaryTensor,i=l.webnnUploadTensor;if(!r||!i)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let a=await r(n,e,p);i(a,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s=a}else u=t.byteLength,s=l._malloc(u),r.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,u),s)}else u=t.byteLength,s=l._malloc(u),r.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,u),s)}}let y=l.stackSave(),m=l.stackAlloc(4*p.length);try{p.forEach((e,t)=>l.setValue(m+t*f,e,4===f?"i32":"i64"));let e=l._OrtCreateTensor(Je(d),s,u,m,p.length,at(h));0===e&&Fe(`Can't create tensor for input/output. session=${n}, index=${a}.`),t.push(e)}finally{l.stackRestore(y)}},Qt=async(e,t,r,n,i,a)=>{let o=Ne(),s=o.PTR_SIZE,u=Vt.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let l=u[0],f=u[1],d=u[2],p=u[3],c=u[4],h=u[5],y=t.length,m=n.length,w=0,g=[],b=[],v=[],C=[],T=o.stackSave(),_=o.stackAlloc(y*s),E=o.stackAlloc(y*s),A=o.stackAlloc(m*s),x=o.stackAlloc(m*s);try{[w,g]=Ve(a),U("wasm prepareInputOutputTensor");for(let n=0;n<y;n++)await Xt(r[n],b,C,e,f[t[n]],t[n],c);for(let t=0;t<m;t++)await Xt(i[t],v,C,e,d[n[t]],y+n[t],c);B("wasm prepareInputOutputTensor");for(let e=0;e<y;e++)o.setValue(_+e*s,b[e],"*"),o.setValue(E+e*s,f[t[e]],"*");for(let e=0;e<m;e++)o.setValue(A+e*s,v[e],"*"),o.setValue(x+e*s,d[n[e]],"*");if(p&&!h){let{handle:r,outputPreferredLocations:a,outputPreferredLocationsEncoded:s}=p;if(f.length!==y)throw new Error(`input count from feeds (${y}) is expected to be always equal to model's input count (${f.length}).`);U("wasm bindInputsOutputs");for(let n=0;n<y;n++){let i=t[n];0!==await o._OrtBindInput(r,f[i],b[n])&&Fe(`Can't bind input[${n}] for session=${e}.`)}for(let t=0;t<m;t++){let u=n[t];i[t]?.[3]?0!==o._OrtBindOutput(r,d[u],v[t],0)&&Fe(`Can't bind pre-allocated output[${t}] for session=${e}.`):0!==o._OrtBindOutput(r,d[u],0,s[u])&&Fe(`Can't bind output[${t}] to ${a[t]} for session=${e}.`)}B("wasm bindInputsOutputs"),Vt.set(e,[l,f,d,p,c,!0])}let u;o.jsepOnRunStart?.(l),o.webnnOnRunStart?.(l),u=p?await o._OrtRunWithBinding(l,p.handle,m,A,w):await o._OrtRun(l,E,_,y,x,m,A,w),0!==u&&Fe("failed to call OrtRun().");let T=[],O=[];U("wasm ProcessOutputTensor");for(let t=0;t<m;t++){let r=Number(o.getValue(A+t*s,"*"));if(r===v[t]){T.push(i[t]);continue}let a,u=o.stackSave(),l=o.stackAlloc(4*s),f=!1,d=0;try{0!==o._OrtGetTensorData(r,l,l+s,l+2*s,l+3*s)&&Fe(`Can't access output tensor data on index ${t}.`);let i=4===s?"i32":"i64",u=Number(o.getValue(l,i));d=o.getValue(l+s,"*");let c=o.getValue(l+2*s,"*"),h=Number(o.getValue(l+3*s,i)),y=[];for(let e=0;e<h;e++)y.push(Number(o.getValue(c+e*s,i)));0!==o._OrtFree(c)&&Fe("Can't free memory for tensor dims.");let m=y.reduce((e,t)=>e*t,1);a=Ke(u);let w=p?.outputPreferredLocations[n[t]];if("string"===a){if("gpu-buffer"===w||"ml-tensor"===w)throw new Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<m;t++){let r=o.getValue(d+t*s,"*"),n=o.getValue(d+(t+1)*s,"*"),i=t===m-1?void 0:n-r;e.push(o.UTF8ToString(r,i))}T.push([a,y,e,"cpu"])}else if("gpu-buffer"===w&&m>0){let t=o.webgpuGetBuffer;if(!t)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let n=t(d),i=et(u,m);if(void 0===i||!nt(a))throw new Error(`Unsupported data type: ${a}`);f=!0;{o.webgpuRegisterBuffer(n,e,d);let t=o.webgpuCreateDownloader(n,i,e);T.push([a,y,{gpuBuffer:n,download:async()=>{let e=await t();return new(tt(a))(e)},dispose:()=>{0!==o._OrtReleaseTensor(r)&&Fe("Can't release tensor.")}},"gpu-buffer"])}}else if("ml-tensor"===w&&m>0){let t=o.webnnEnsureTensor,n=o.webnnIsGraphInputOutputTypeSupported;if(!t||!n)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===et(u,m)||!it(a))throw new Error(`Unsupported data type: ${a}`);if(!n(e,a,!1))throw new Error(`preferredLocation "ml-tensor" for ${a} output is not supported by current WebNN Context.`);let i=await t(e,d,u,y,!1);f=!0,T.push([a,y,{mlTensor:i,download:o.webnnCreateMLTensorDownloader(d,a),dispose:()=>{o.webnnReleaseTensorId(d),o._OrtReleaseTensor(r)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===w&&m>0){let e=o.webnnCreateMLTensorDownloader(d,a)(),t=T.length;f=!0,O.push((async()=>{let n=[t,await e];return o.webnnReleaseTensorId(d),o._OrtReleaseTensor(r),n})()),T.push([a,y,[],"cpu"])}else{let e=new(tt(a))(m);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o.HEAPU8.subarray(d,d+e.byteLength)),T.push([a,y,e,"cpu"])}}finally{o.stackRestore(u),"string"===a&&d&&o._free(d),f||o._OrtReleaseTensor(r)}}p&&!c&&(0!==o._OrtClearBoundOutputs(p.handle)&&Fe("Can't clear bound outputs."),Vt.set(e,[l,f,d,p,c,!1]));for(let[e,t]of await Promise.all(O))T[e][2]=t;return B("wasm ProcessOutputTensor"),T}finally{o.webnnOnRunEnd?.(l),o.stackRestore(T),r.forEach(e=>{e&&"gpu-buffer"===e[3]&&o.webgpuUnregisterBuffer(e[2].gpuBuffer)}),i.forEach(e=>{e&&"gpu-buffer"===e[3]&&o.webgpuUnregisterBuffer(e[2].gpuBuffer)}),b.forEach(e=>o._OrtReleaseTensor(e)),v.forEach(e=>o._OrtReleaseTensor(e)),C.forEach(e=>o._free(e)),0!==w&&o._OrtReleaseRunOptions(w),g.forEach(e=>o._free(e))}},Jt=e=>{let t=Ne(),r=Vt.get(e);if(!r)throw new Error("invalid session id");let n=r[0],i=t._OrtEndProfiling(n);0===i&&Fe("Can't get an profile file name."),t._OrtFree(i)},Kt=e=>{let t=[];for(let r of e){let e=r[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),_r=D(()=>{se(),Tr(),It(),Ot(),er=()=>!!l.wasm.proxy&&typeof document<"u",rr=!1,nr=!1,ir=!1,sr=new Map,ur=(e,t)=>{let r=sr.get(e);r?r.push(t):sr.set(e,[t])},lr=()=>{if(rr||!nr||ir||!tr)throw new Error("worker not ready")},fr=e=>{switch(e.data.type){case"init-wasm":rr=!1,e.data.err?(ir=!0,or[1](e.data.err)):(nr=!0,or[0]()),ar&&(URL.revokeObjectURL(ar),ar=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=sr.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},dr=async()=>{if(!nr){if(rr)throw new Error("multiple calls to 'initWasm()' detected.");if(ir)throw new Error("previous call to 'initWasm()' failed.");if(rr=!0,er())return new Promise((e,t)=>{tr?.terminate(),Se().then(([r,n])=>{try{(tr=n).onerror=e=>t(e),tr.onmessage=fr,or=[e,t];let i={type:"init-wasm",in:l};!i.in.wasm.wasmPaths&&(r||be)&&(i.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),tr.postMessage(i),ar=r}catch(e){t(e)}},t)});try{await De(l.wasm),await Gt(l),nr=!0}catch(e){throw ir=!0,e}finally{rr=!1}}},pr=async e=>{if(er())return lr(),new Promise((t,r)=>{ur("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:l}};tr.postMessage(n)});await Ft(l,e)},cr=async e=>er()?(lr(),new Promise((t,r)=>{ur("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};tr.postMessage(n,[e.buffer])})):qt(e),hr=async(e,t)=>{if(er()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return lr(),new Promise((r,n)=>{ur("create",[r,n]);let i={type:"create",in:{model:e,options:{...t}}},a=[];e instanceof Uint8Array&&a.push(e.buffer),tr.postMessage(i,a)})}return Yt(e,t)},yr=async e=>{if(er())return lr(),new Promise((t,r)=>{ur("release",[t,r]);let n={type:"release",in:e};tr.postMessage(n)});Zt(e)},mr=async(e,t,r,n,i,a)=>{if(er()){if(r.some(e=>"cpu"!==e[3]))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(e=>e))throw new Error("pre-allocated output tensor is not supported for proxy.");return lr(),new Promise((i,o)=>{ur("run",[i,o]);let s=r,u={type:"run",in:{sessionId:e,inputIndices:t,inputs:s,outputIndices:n,options:a}};tr.postMessage(u,Kt(s))})}return Qt(e,t,r,n,i,a)},wr=async e=>{if(er())return lr(),new Promise((t,r)=>{ur("end-profiling",[t,r]);let n={type:"end-profiling",in:e};tr.postMessage(n)});Jt(e)}}),Er=D(()=>{se(),_r(),Rt(),ue(),Mt(),gr=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},br=e=>{switch(e[3]){case"cpu":return new A(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!nt(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:i}=e[2];return A.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:i})}case"ml-tensor":{let t=e[0];if(!it(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:i}=e[2];return A.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},vr=class{async fetchModelAndCopyToWasmMemory(e){return cr(await ot(e))}async loadModel(e,t){let r;I(),r="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await hr(r,t),S()}async dispose(){return yr(this.sessionId)}async run(e,t,r){I();let n=[],i=[];Object.entries(e).forEach(e=>{let t=e[0],r=e[1],a=this.inputNames.indexOf(t);if(-1===a)throw new Error(`invalid input '${t}'`);n.push(r),i.push(a)});let a=[],o=[];Object.entries(t).forEach(e=>{let t=e[0],r=e[1],n=this.outputNames.indexOf(t);if(-1===n)throw new Error(`invalid output '${t}'`);a.push(r),o.push(n)});let s=n.map((e,t)=>gr(e,()=>`input "${this.inputNames[i[t]]}"`)),u=a.map((e,t)=>e?gr(e,()=>`output "${this.outputNames[o[t]]}"`):null),l=await mr(this.sessionId,i,s,o,u,r),f={};for(let e=0;e<l.length;e++)f[this.outputNames[o[e]]]=a[e]??br(l[e]);return S(),f}startProfiling(){}endProfiling(){wr(this.sessionId)}}}),Ar={};N(Ar,{OnnxruntimeWebAssemblyBackend:()=>Or,initializeFlags:()=>xr,wasmBackend:()=>Ir});var xr,Or,Ir,Sr=D(()=>{se(),_r(),Er(),xr=()=>{("number"!=typeof l.wasm.initTimeout||l.wasm.initTimeout<0)&&(l.wasm.initTimeout=0);let e=l.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),l.wasm.simd=!1),"boolean"!=typeof l.wasm.proxy&&(l.wasm.proxy=!1),"boolean"!=typeof l.wasm.trace&&(l.wasm.trace=!1),"number"!=typeof l.wasm.numThreads||!Number.isInteger(l.wasm.numThreads)||l.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)l.wasm.numThreads=1;else{let e=typeof navigator>"u"?k("node:os").cpus().length:navigator.hardwareConcurrency;l.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},Ir=new(Or=class{async init(e){xr(),await dr(),await pr(e)}async createInferenceSessionHandler(e,t){let r=new vr;return await r.loadModel(e,t),r}})});se(),se(),se();var Ur=oe;{let e=(Sr(),W(Ar)).wasmBackend;n("webgpu",e,5),n("webnn",e,5),n("cpu",e,10),n("wasm",e,10)}Object.defineProperty(l.versions,"web",{value:"1.23.0",enumerable:!0});export{M as InferenceSession,x as TRACE,U as TRACE_EVENT_BEGIN,B as TRACE_EVENT_END,I as TRACE_FUNC_BEGIN,S as TRACE_FUNC_END,A as Tensor,Ur as default,l as env,n as registerBackend};